<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý người dùng - EduShare Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/toast.css">
    <link rel="stylesheet" href="css/admin_users.css">
</head>

<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-logo">
                <a href="index.html" class="logo">
                    <div class="logo-icon">E</div>
                    <div class="logo-text">EduShare</div>
                </a>
            </div>

            <div class="admin-header-actions">
                <div class="admin-search">
                    <input type="text" placeholder="Tìm kiếm...">
                    <button><i class="fas fa-search"></i></button>
                </div>

                <div class="dark-mode-toggle" id="darkModeToggle"></div>

                <div class="admin-notifications">
                    <button type="button" class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </button>
                </div>

                <div class="admin-profile">
                    <div class="admin-avatar">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                            alt="Admin">
                    </div>
                    <div class="admin-info">
                        <span class="admin-name">Nguyễn Văn A</span>
                        <span class="admin-role">Quản trị viên</span>
                    </div>
                    <div class="admin-dropdown">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <ul class="admin-menu">
                    <li class="admin-menu-item">
                        <a href="index.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Bảng điều khiển</span>
                        </a>
                    </li>
                    <li class="admin-menu-item active">
                        <a href="users.html">
                            <i class="fas fa-users"></i>
                            <span>Quản lý người dùng</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="documents.html">
                            <i class="fas fa-file-alt"></i>
                            <span>Quản lý tài liệu</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="categories.html">
                            <i class="fas fa-folder"></i>
                            <span>Quản lý danh mục</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="tags.html">
                            <i class="fas fa-tags"></i>
                            <span>Quản lý tags</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="comments.html">
                            <i class="fas fa-comments"></i>
                            <span>Quản lý bình luận</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="reports.html">
                            <i class="fas fa-flag"></i>
                            <span>Báo cáo vi phạm</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="ip-bans.html">
                            <i class="fas fa-ban"></i>
                            <span>IP bị cấm</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="statistics.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Thống kê</span>
                        </a>
                    </li>
                    <!-- Revenue Management Dropdown -->
                    <li class="admin-menu-item has-submenu">
                        <a href="javascript:void(0)">
                            <i class="fas fa-coins"></i>
                            <span>Quản lý doanh thu</span>
                            <i class="fas fa-chevron-down submenu-icon"></i>
                        </a>
                        <ul class="submenu">
                            <li class="submenu-item">
                                <a href="coin-packages.html">
                                    <i class="fas fa-box"></i>
                                    <span>Gói xu</span>
                                </a>
                            </li>
                            <li class="submenu-item">
                                <a href="transactions.html">
                                    <i class="fas fa-exchange-alt"></i>
                                    <span>Giao dịch</span>
                                </a>
                            </li>
                            <li class="submenu-item">
                                <a href="withdrawals.html">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Yêu cầu rút tiền</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="admin-menu-item">
                        <a href="settings.html">
                            <i class="fas fa-cog"></i>
                            <span>Cài đặt</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="../index.html">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Đăng xuất</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <div class="admin-content-header">
                <h1 class="admin-page-title">Quản lý người dùng</h1>
                <div class="admin-breadcrumbs">
                    <a href="index.html">Admin</a>
                    <span>/</span>
                    <span>Quản lý người dùng</span>
                </div>
            </div>

            <!-- User Management Tools -->
            <div class="management-tools">
                <div class="search-filters">
                    <div class="tool-item">
                        <input type="text" placeholder="Tìm kiếm người dùng..." class="search-input">
                    </div>
                    <div class="tool-item">
                        <select class="filter-select">
                            <option value="all">Tất cả vai trò</option>
                            <option value="admin">Quản trị viên</option>
                            <option value="user">Người dùng</option>
                            <option value="contributor">Cộng tác viên</option>
                        </select>
                    </div>
                    <div class="tool-item">
                        <select class="filter-select">
                            <option value="all">Tất cả trạng thái</option>
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Tạm khóa</option>
                            <option value="pending">Chờ xác nhận</option>
                        </select>
                    </div>

                </div>
                <div class="action-buttons">
                    <button type="button" class="add-new-btn">
                        <i class="fas fa-plus"></i> Thêm người dùng
                    </button>
                    <button type="button" class="export-btn">
                        <i class="fas fa-download"></i> Xuất dữ liệu
                    </button>
                </div>
            </div>
             <!-- Advanced Filters Toggle -->
             <div class="advanced-filters-toggle">
                <button type="button" class="advanced-filter-toggle" id="advancedFilterToggle">
                    <i class="fas fa-sliders-h"></i>
                    Bộ lọc nâng cao
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </button>
            </div>
            <!-- Advanced Filters Panel -->
            <div class="advanced-filters-panel" id="advancedFiltersPanel">
                <div class="advanced-filters-header">
                    <h3>
                        <i class="fas fa-filter"></i>
                        Bộ lọc nâng cao
                    </h3>
                    <div class="advanced-filters-actions">
                        <button type="button" class="filter-preset-btn" id="saveFilterPreset" title="Lưu bộ lọc">
                            <i class="fas fa-bookmark"></i>
                            Lưu
                        </button>
                        <button type="button" class="filter-preset-btn" id="loadFilterPreset" title="Tải bộ lọc đã lưu">
                            <i class="fas fa-folder-open"></i>
                            Tải
                        </button>
                        <button type="button" class="filter-clear-btn" id="clearAllFilters" title="Xóa tất cả bộ lọc">
                            <i class="fas fa-eraser"></i>
                            Xóa tất cả
                        </button>
                    </div>
                </div>

                <div class="advanced-filters-content">
                    <!-- Date Range Filters -->
                    <div class="filter-group">
                        <h4 class="filter-group-title">
                            <i class="fas fa-calendar-alt"></i>
                            Khoảng thởi gian
                        </h4>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Ngày đăng ký từ:</label>
                                <input type="date" class="date-filter" id="regDateFrom">
                            </div>
                            <div class="filter-item">
                                <label>Đến:</label>
                                <input type="date" class="date-filter" id="regDateTo">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Đăng nhập cuối từ:</label>
                                <input type="date" class="date-filter" id="lastLoginFrom">
                            </div>
                            <div class="filter-item">
                                <label>Đến:</label>
                                <input type="date" class="date-filter" id="lastLoginTo">
                            </div>
                        </div>
                    </div>

                    <!-- Activity Filters -->
                    <div class="filter-group">
                        <h4 class="filter-group-title">
                            <i class="fas fa-chart-line"></i>
                            Hoạt động người dùng
                        </h4>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Số tài liệu tối thiểu:</label>
                                <input type="number" class="number-filter" id="minDocuments" min="0" placeholder="0">
                            </div>
                            <div class="filter-item">
                                <label>Số tải xuống tối thiểu:</label>
                                <input type="number" class="number-filter" id="minDownloads" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Đánh giá tối thiểu:</label>
                                <select class="filter-select" id="minRating">
                                    <option value="">Tất cả</option>
                                    <option value="1">1 sao trở lên</option>
                                    <option value="2">2 sao trở lên</option>
                                    <option value="3">3 sao trở lên</option>
                                    <option value="4">4 sao trở lên</option>
                                    <option value="5">5 sao</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label>Trạng thái hoạt động:</label>
                                <select class="filter-select" id="activityStatus">
                                    <option value="">Tất cả</option>
                                    <option value="very-active">Rất tích cực (7 ngày)</option>
                                    <option value="active">Tích cực (30 ngày)</option>
                                    <option value="inactive">Ít hoạt động (90 ngày)</option>
                                    <option value="dormant">Không hoạt động (>90 ngày)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Multi-Select Filters -->
                    <div class="filter-group">
                        <h4 class="filter-group-title">
                            <i class="fas fa-check-square"></i>
                            Lựa chọn nhiều tiêu chí
                        </h4>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Vai trò (nhiều lựa chọn):</label>
                                <div class="multi-select-container">
                                    <div class="multi-select-display" id="roleMultiSelect">
                                        <span class="placeholder">Chọn vai trò...</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="multi-select-dropdown" id="roleMultiDropdown">
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="role_admin" value="admin">
                                            <label for="role_admin">
                                                <i class="fas fa-crown"></i>
                                                Quản trị viên
                                            </label>
                                        </div>
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="role_contributor" value="contributor">
                                            <label for="role_contributor">
                                                <i class="fas fa-user-edit"></i>
                                                Cộng tác viên
                                            </label>
                                        </div>
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="role_user" value="user">
                                            <label for="role_user">
                                                <i class="fas fa-user"></i>
                                                Người dùng
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-item">
                                <label>Trạng thái (nhiều lựa chọn):</label>
                                <div class="multi-select-container">
                                    <div class="multi-select-display" id="statusMultiSelect">
                                        <span class="placeholder">Chọn trạng thái...</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="multi-select-dropdown" id="statusMultiDropdown">
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="status_active" value="active">
                                            <label for="status_active">
                                                <i class="fas fa-check-circle status-active"></i>
                                                Hoạt động
                                            </label>
                                        </div>
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="status_inactive" value="inactive">
                                            <label for="status_inactive">
                                                <i class="fas fa-ban status-inactive"></i>
                                                Tạm khóa
                                            </label>
                                        </div>
                                        <div class="multi-select-option">
                                            <input type="checkbox" id="status_pending" value="pending">
                                            <label for="status_pending">
                                                <i class="fas fa-clock status-pending"></i>
                                                Chờ xác nhận
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Search Filters -->
                    <div class="filter-group">
                        <h4 class="filter-group-title">
                            <i class="fas fa-search"></i>
                            Tìm kiếm nâng cao
                        </h4>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Tìm theo email:</label>
                                <input type="email" class="text-filter" id="emailSearch" placeholder="Nhập email...">
                            </div>
                            <div class="filter-item">
                                <label>Tìm theo tên đầy đủ:</label>
                                <input type="text" class="text-filter" id="fullNameSearch" placeholder="Nhập tên...">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>Tìm theo số điện thoại:</label>
                                <input type="tel" class="text-filter" id="phoneSearch"
                                    placeholder="Nhập số điện thoại...">
                            </div>
                            <div class="filter-item">
                                <label>Tìm theo ID người dùng:</label>
                                <input type="text" class="text-filter" id="userIdSearch" placeholder="Nhập User ID...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Filters Footer -->
                <div class="advanced-filters-footer">
                    <div class="filter-results-info">
                        <span id="filterResultsCount">Hiển thị tất cả người dùng</span>
                    </div>
                    <div class="filter-actions">
                        <button type="button" class="filter-apply-btn" id="applyAdvancedFilters">
                            <i class="fas fa-check"></i>
                            Áp dụng bộ lọc
                        </button>
                        <button type="button" class="filter-reset-btn" id="resetAdvancedFilters">
                            <i class="fas fa-undo"></i>
                            Đặt lại
                        </button>
                    </div>
                </div>
            </div>
            <!-- Bulk Actions Toolbar (Hidden by default) -->
            <div class="bulk-actions-toolbar" id="bulkActionsToolbar">
                <div class="bulk-actions-content">
                    <div class="bulk-actions-info">
                        <span class="selected-count">0</span> người dùng được chọn
                    </div>

                    <div class="bulk-actions-buttons">
                        <button type="button" class="bulk-action-btn" id="bulkActivateBtn" title="Kích hoạt tài khoản">
                            <i class="fas fa-check-circle"></i>
                            Kích hoạt
                        </button>

                        <button type="button" class="bulk-action-btn" id="bulkDeactivateBtn" title="Khóa tài khoản">
                            <i class="fas fa-ban"></i>
                            Khóa
                        </button>

                        <div class="bulk-action-dropdown">
                            <button type="button" class="bulk-action-btn dropdown-toggle" id="bulkRoleBtn" title="Thay đổi vai trò">
                                <i class="fas fa-user-tag"></i>
                                Vai trò
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="dropdown-menu" id="bulkRoleDropdown">
                                <button type="button" class="dropdown-item" data-role="admin">
                                    <i class="fas fa-crown"></i>
                                    Quản trị viên
                                </button>
                                <button type="button" class="dropdown-item" data-role="contributor">
                                    <i class="fas fa-user-edit"></i>
                                    Cộng tác viên
                                </button>
                                <button type="button" class="dropdown-item" data-role="user">
                                    <i class="fas fa-user"></i>
                                    Người dùng
                                </button>
                            </div>
                        </div>

                        <button type="button" class="bulk-action-btn" id="bulkEmailBtn" title="Gửi email">
                            <i class="fas fa-envelope"></i>
                            Gửi email
                        </button>

                        <button type="button" class="bulk-action-btn danger" id="bulkDeleteBtn" title="Xóa người dùng">
                            <i class="fas fa-trash"></i>
                            Xóa
                        </button>

                        <button type="button" class="bulk-action-btn secondary" id="bulkClearBtn" title="Bỏ chọn tất cả">
                            <i class="fas fa-times"></i>
                            Bỏ chọn
                        </button>
                    </div>
                </div>

                <!-- Progress Bar for Bulk Operations -->
                <div class="bulk-progress" id="bulkProgress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Đang xử lý...</div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="data-container">
                <table class="data-table users-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="selectAll">
                                    <label for="selectAll"></label>
                                </div>
                            </th>
                            <th>Người dùng</th>
                            <th>Email</th>
                            <th>Vai trò</th>
                            <th class="sortable" data-sort="joinDate">Ngày đăng ký <i class="fas fa-sort"></i></th>
                            <th class="sortable" data-sort="documents">Số tài liệu <i class="fas fa-sort"></i></th>
                            <th class="sortable" data-sort="downloads">Lượt tải <i class="fas fa-sort"></i></th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user1">
                                    <label for="user1"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Nguyễn Văn A" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Nguyễn Văn A</div>
                                        <div class="user-username">@nguyenvana <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>nguyenvana@example.com</td>
                            <td><span class="role-badge admin">Quản trị viên</span></td>
                            <td>15/03/2023</td>
                            <td>32</td>
                            <td>120</td>
                            <td><span class="status-badge approved">Hoạt động</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn edit-user-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="action-btn" title="Khóa tài khoản"><i
                                            class="fas fa-lock"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user2">
                                    <label for="user2"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Trần Thị B" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Trần Thị B</div>
                                        <div class="user-username">@tranthib <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>tranthib@example.com</td>
                            <td><span class="role-badge contributor">Cộng tác viên</span></td>
                            <td>24/03/2023</td>
                            <td>18</td>
                            <td>75</td>
                            <td><span class="status-badge approved">Hoạt động</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn edit-user-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="action-btn" title="Khóa tài khoản"><i
                                            class="fas fa-lock"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user3">
                                    <label for="user3"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Lê Văn C" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Lê Văn C</div>
                                        <div class="user-username">@levanc <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>levanc@example.com</td>
                            <td><span class="role-badge user">Người dùng</span></td>
                            <td>05/04/2023</td>
                            <td>5</td>
                            <td>10</td>
                            <td><span class="status-badge approved">Hoạt động</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn edit-user-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="action-btn" title="Khóa tài khoản"><i
                                            class="fas fa-lock"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user4">
                                    <label for="user4"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Phạm Thị D" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Phạm Thị D</div>
                                        <div class="user-username">@phamthid <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>phamthid@example.com</td>
                            <td><span class="role-badge user">Người dùng</span></td>
                            <td>12/04/2023</td>
                            <td>0</td>
                            <td>0</td>
                            <td><span class="status-badge pending">Chờ xác nhận</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn" title="Xác nhận"><i class="fas fa-check"></i></button>
                                    <button type="button" class="action-btn" title="Từ chối"><i class="fas fa-times"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user5">
                                    <label for="user5"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1507003211169-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Vũ Văn E" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Vũ Văn E</div>
                                        <div class="user-username">@vuvane <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>vuvane@example.com</td>
                            <td><span class="role-badge user">Người dùng</span></td>
                            <td>18/03/2023</td>
                            <td>12</td>
                            <td>55</td>
                            <td><span class="status-badge rejected">Tạm khóa</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn" title="Mở khóa"><i class="fas fa-unlock"></i></button>
                                    <button type="button" class="action-btn" title="Xóa"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user6">
                                    <label for="user6"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1573497019940-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Đỗ Thị F" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Đỗ Thị F</div>
                                        <div class="user-username">@dothif <i class="fas fa-sticky-note note-indicator" title="Có ghi chú" style="display:none;"></i></div>
                                    </div>
                                </div>
                            </td>
                            <td>dothif@example.com</td>
                            <td><span class="role-badge contributor">Cộng tác viên</span></td>
                            <td>27/03/2023</td>
                            <td>24</td>
                            <td>98</td>
                            <td><span class="status-badge approved">Hoạt động</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn edit-user-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="action-btn" title="Khóa tài khoản"><i
                                            class="fas fa-lock"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="user7">
                                    <label for="user7"></label>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <img src="https://images.unsplash.com/photo-1504199367641-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                        alt="Ngô Văn G" class="user-avatar">
                                    <div class="user-details">
                                        <div class="user-name">Ngô Văn G</div>
                                        <div class="user-username">@ngovang</div>
                                    </div>
                                </div>
                            </td>
                            <td>ngovang@example.com</td>
                            <td><span class="role-badge user">Người dùng</span></td>
                            <td>04/04/2023</td>
                            <td>7</td>
                            <td>7</td>
                            <td><span class="status-badge approved">Hoạt động</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button type="button" class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                                    <button type="button" class="action-btn edit-user-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="action-btn" title="Khóa tài khoản"><i
                                            class="fas fa-lock"></i></button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button type="button" class="pagination-btn prev-btn" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="pagination-pages">
                    <button type="button" class="pagination-btn page-btn active">1</button>
                    <button type="button" class="pagination-btn page-btn">2</button>
                    <button type="button" class="pagination-btn page-btn">3</button>
                    <span class="pagination-ellipsis">...</span>
                    <button type="button" class="pagination-btn page-btn">12</button>
                </div>
                <button type="button" class="pagination-btn next-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Add User Modal -->
            <div class="modal" id="addUserModal">
                <div class="modal-overlay"></div>
                <div class="modal-container">
                    <div class="modal-header">
                        <h3>Thêm người dùng mới</h3>
                        <button type="button" class="modal-close"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <form class="form-grid">
                            <div class="form-group">
                                <label for="userName">Họ và tên</label>
                                <input type="text" id="userName" placeholder="Nhập họ và tên">
                            </div>
                            <div class="form-group">
                                <label for="userEmail">Email</label>
                                <input type="email" id="userEmail" placeholder="Nhập địa chỉ email">
                            </div>
                            <div class="form-group">
                                <label for="userUsername">Tên đăng nhập</label>
                                <input type="text" id="userUsername" placeholder="Nhập tên đăng nhập">
                            </div>
                            <div class="form-group">
                                <label for="userPassword">Mật khẩu</label>
                                <input type="password" id="userPassword" placeholder="Nhập mật khẩu">
                            </div>
                            <div class="form-group">
                                <label for="userRole">Vai trò</label>
                                <select id="userRole">
                                    <option value="user">Người dùng</option>
                                    <option value="contributor">Cộng tác viên</option>
                                    <option value="admin">Quản trị viên</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="userStatus">Trạng thái</label>
                                <select id="userStatus">
                                    <option value="active">Hoạt động</option>
                                    <option value="inactive">Tạm khóa</option>
                                    <option value="pending">Chờ xác nhận</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Ảnh đại diện</label>
                                <div class="avatar-upload">
                                    <div class="avatar-preview">
                                        <div class="avatar-placeholder">
                                            <i class="fas fa-user"></i>
                                        </div>
                                    </div>
                                    <div class="avatar-actions">
                                        <button type="button" type="button" class="avatar-upload-btn">
                                            <i class="fas fa-upload"></i> Tải lên
                                        </button>
                                        <button type="button" type="button" class="avatar-remove-btn">
                                            <i class="fas fa-trash"></i> Xóa
                                        </button>
                                    </div>
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="userBio">Giới thiệu</label>
                                <textarea id="userBio" rows="4" placeholder="Nhập thông tin giới thiệu" class="form-control"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="cancel-btn">Hủy bỏ</button>
                        <button type="button" class="save-btn">Lưu</button>
                    </div>
                </div>
            </div>

            <!-- User Detail Modal - Enhanced with Advanced Management -->
            <div class="modal" id="userDetailModal">
                <div class="modal-overlay"></div>
                <div class="modal-container extra-large-modal">
                    <div class="modal-header">
                        <h3>
                            <i class="fas fa-user-cog"></i>
                            Quản lý chi tiết người dùng
                        </h3>
                        <button type="button" class="close-modal" onclick="closeModal('userDetailModal')">&times;</button>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="user-detail-tabs">
                        <button type="button" class="user-tab-btn active" data-target="basic-info">Thông tin</button>
                        <button type="button" class="user-tab-btn" data-target="activity-logs">Hoạt động</button>
                        <button type="button" class="user-tab-btn" data-target="trust-reputation">Độ tin cậy</button>
                        <button type="button" class="user-tab-btn" data-target="groups-organization">Nhóm</button>
                        <button type="button" class="user-tab-btn" data-target="limits-quotas">Hạn mức</button>
                        <button type="button" class="user-tab-btn" data-target="permissions-roles">Quyền</button>
                    </div>

                    <div class="modal-content">
                        <!-- Tab 1: Basic Info -->
                        <div class="tab-content active" id="basic-info">
                            <div class="user-detail-grid">
                                <!-- User Basic Info -->
                                <div class="user-detail-section">
                                    <h4>
                                        <i class="fas fa-id-card"></i>
                                        Thông tin cá nhân
                                    </h4>
                                    <div class="user-detail-card">
                                        <div class="user-detail-avatar">
                                            <img id="detailUserAvatar" src="" alt="User Avatar">
                                            <div class="avatar-status-indicator" id="detailUserOnlineStatus"></div>
                                        </div>
                                        <div class="user-detail-info">
                                            <div class="detail-item">
                                                <label>Tên người dùng:</label>
                                                <span id="detailUserName"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Username:</label>
                                                <span id="detailUserUsername"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Email:</label>
                                                <span id="detailUserEmail"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Vai trò:</label>
                                                <span id="detailUserRole" class="role-badge"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Trạng thái:</label>
                                                <span id="detailUserStatus" class="status-badge"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Ngày đăng ký:</label>
                                                <span id="detailUserJoinDate"></span>
                                            </div>
                                            <div class="detail-item">
                                                <label>Lần đăng nhập cuối:</label>
                                                <span id="detailUserLastLogin"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- User Statistics -->
                                <div class="user-detail-section">
                                    <h4>
                                        <i class="fas fa-chart-line"></i>
                                        Thống kê hoạt động
                                    </h4>
                                    <div class="user-stats-grid">
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-number" id="detailUserDocuments">0</div>
                                                <div class="stat-label">Tài liệu</div>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-download"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-number" id="detailUserDownloads">0</div>
                                                <div class="stat-label">Lượt tải</div>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-comments"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-number" id="detailUserComments">0</div>
                                                <div class="stat-label">Bình luận</div>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-number" id="detailUserRating">0</div>
                                                <div class="stat-label">Điểm đánh giá</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Notes Section -->
                        <div class="user-detail-section admin-notes-section">
                            <h4>
                                <i class="fas fa-sticky-note"></i>
                                Ghi chú của Admin
                            </h4>
                            <textarea id="adminNotesTextarea" rows="4" placeholder="Nhập ghi chú về người dùng..." class="admin-notes-textarea"></textarea>
                            <div class="admin-notes-actions">
                                <button type="button" class="save-btn" id="saveAdminNotesBtn">
                                    <i class="fas fa-save"></i>
                                    Lưu ghi chú
                                </button>
                            </div>
                        </div>

                        <!-- Tab 2: Activity Logs -->
                        <div class="tab-content" id="activity-logs">
                            <div class="activity-logs-container">
                                <!-- Activity Controls Header -->
                                <div class="activity-controls-header">
                                    <div class="header-actions">
                                        <button type="button" class="btn-sm btn-outline" id="toggleAdvancedActivityFilters">
                                            <i class="fas fa-filter"></i> Bộ lọc nâng cao
                                        </button>
                                        <button type="button" class="btn-sm btn-outline">
                                            <i class="fas fa-file-export"></i> Xuất nhật ký
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Advanced Activity Filters -->
                                <div class="advanced-activity-filters" style="display:none">
                                    <div class="filter-panel">
                                        <div class="filter-grid">
                                            <div class="filter-group">
                                                <h5>Thời gian</h5>
                                                <div class="filter-inputs">
                                                    <select class="form-select form-select-sm" id="timeRangePreset">
                                                        <option value="today">Hôm nay</option>
                                                        <option value="yesterday">Hôm qua</option>
                                                        <option value="last7">7 ngày qua</option>
                                                        <option value="last30">30 ngày qua</option>
                                                        <option value="thisMonth">Tháng này</option>
                                                        <option value="lastMonth">Tháng trước</option>
                                                        <option value="custom">Tùy chỉnh...</option>
                                                    </select>
                                                    <div class="custom-date-range" style="display:none">
                                                        <div class="date-range-inputs">
                                                            <input type="date" class="form-control form-control-sm" id="activityDateFrom">
                                                            <span>đến</span>
                                                            <input type="date" class="form-control form-control-sm" id="activityDateTo">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="filter-group">
                                                <h5>Loại hoạt động</h5>
                                                <div class="checkbox-grid">
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="login" checked>
                                                        <span>Đăng nhập</span>
                                                    </label>
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="upload" checked>
                                                        <span>Tải lên</span>
                                                    </label>
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="download" checked>
                                                        <span>Tải xuống</span>
                                                    </label>
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="share" checked>
                                                        <span>Chia sẻ</span>
                                                    </label>
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="comment" checked>
                                                        <span>Bình luận</span>
                                                    </label>
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" value="edit" checked>
                                                        <span>Chỉnh sửa</span>
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="filter-group">
                                                <h5>Thiết bị & Địa điểm</h5>
                                                <div class="filter-inputs">
                                                    <select class="form-select form-select-sm" id="deviceFilter">
                                                        <option value="">Tất cả thiết bị</option>
                                                        <option value="desktop">Máy tính để bàn</option>
                                                        <option value="laptop">Laptop</option>
                                                        <option value="mobile">Điện thoại di động</option>
                                                        <option value="tablet">Máy tính bảng</option>
                                                    </select>
                                                    <input type="text" class="form-control form-control-sm" placeholder="IP Address..." id="ipFilter">
                                                    <input type="text" class="form-control form-control-sm" placeholder="Vị trí..." id="locationFilter">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="filter-actions">
                                            <button type="button" class="btn-sm btn-primary" id="applyActivityFilters">
                                                <i class="fas fa-search"></i> Áp dụng bộ lọc
                                            </button>
                                            <button type="button" class="btn-sm btn-outline" id="resetActivityFilters">
                                                <i class="fas fa-redo"></i> Đặt lại
                                            </button>
                                            <button type="button" class="btn-sm btn-outline" id="saveActivityFilterPreset">
                                                <i class="fas fa-save"></i> Lưu bộ lọc
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Anomaly Detection Alert -->
                                <div class="anomaly-detection">
                                    <div class="section-header">
                                        <h4>
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Phát hiện hành vi bất thường
                                        </h4>
                                        <div class="section-actions">
                                            <select class="form-select form-select-sm">
                                                <option value="week">7 ngày gần đây</option>
                                                <option value="month" selected>30 ngày gần đây</option>
                                                <option value="quarter">3 tháng gần đây</option>
                                            </select>
                                            <button type="button" class="btn-sm btn-outline">
                                                <i class="fas fa-cog"></i> Cài đặt
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="anomaly-results">
                                        <div class="anomaly-summary">
                                            <div class="anomaly-metrics">
                                                <div class="anomaly-metric-card">
                                                    <div class="metric-name">Mức độ nghi ngờ</div>
                                                    <div class="metric-value">
                                                        <span class="value-number">12</span>
                                                        <span class="value-unit">/100</span>
                                                    </div>
                                                    <div class="metric-label low">Thấp</div>
                                                </div>
                                                <div class="anomaly-metric-card">
                                                    <div class="metric-name">Số vụ bất thường</div>
                                                    <div class="metric-value">
                                                        <span class="value-number">2</span>
                                                    </div>
                                                    <div class="metric-label normal">Bình thường</div>
                                                </div>
                                                <div class="anomaly-metric-card">
                                                    <div class="metric-name">Truy cập lạ</div>
                                                    <div class="metric-value">
                                                        <span class="value-number">0</span>
                                                    </div>
                                                    <div class="metric-label good">Tốt</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Anomaly Alert List -->
                                        <div class="anomaly-list">
                                            <div class="anomaly-item">
                                                <div class="anomaly-icon warning">
                                                    <i class="fas fa-globe"></i>
                                                </div>
                                                <div class="anomaly-content">
                                                    <div class="anomaly-title">Đăng nhập từ vị trí lạ</div>
                                                    <div class="anomaly-description">
                                                        Phát hiện đăng nhập từ Hà Nội trong khi hầu hết các lần đăng nhập trước đều từ Hồ Chí Minh.
                                                    </div>
                                                    <div class="anomaly-meta">
                                                        <span class="timestamp">15/06/2024 22:45</span>
                                                        <span class="ip-address">203.162.4.191</span>
                                                    </div>
                                                    <div class="anomaly-actions">
                                                        <button class="btn-sm btn-outline">Đánh dấu an toàn</button>
                                                        <button class="btn-sm btn-danger">Khóa tài khoản</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="anomaly-item">
                                                <div class="anomaly-icon warning">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                                <div class="anomaly-content">
                                                    <div class="anomaly-title">Thời điểm đăng nhập khác thường</div>
                                                    <div class="anomaly-description">
                                                        Phát hiện đăng nhập vào lúc 3:27 sáng, ngoài giờ hoạt động thông thường của người dùng này.
                                                    </div>
                                                    <div class="anomaly-meta">
                                                        <span class="timestamp">12/06/2024 03:27</span>
                                                        <span class="ip-address">192.168.1.107</span>
                                                    </div>
                                                    <div class="anomaly-actions">
                                                        <button class="btn-sm btn-outline">Đánh dấu an toàn</button>
                                                        <button class="btn-sm btn-danger">Khóa tài khoản</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Anomaly Detection Settings Modal Trigger -->
                                        <div class="anomaly-settings-actions">
                                            <button class="btn-sm btn-outline">
                                                <i class="fas fa-cog"></i> Tùy chỉnh phát hiện hành vi
                                            </button>
                                            <button class="btn-sm btn-outline">
                                                <i class="fas fa-eye"></i> Xem tất cả cảnh báo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Login History -->
                                <div class="activity-section">
                                    <h4>
                                        <i class="fas fa-sign-in-alt"></i>
                                        Lịch sử đăng nhập
                                    </h4>
                                    <div class="login-history-table">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Thời gian</th>
                                                    <th>IP Address</th>
                                                    <th>Thiết bị</th>
                                                    <th>Vị trí</th>
                                                    <th>Trạng thái</th>
                                                </tr>
                                            </thead>
                                            <tbody id="loginHistoryData">
                                                <tr>
                                                    <td>17/06/2024 14:30</td>
                                                    <td>192.168.1.105</td>
                                                    <td>Chrome 125 / Windows 10</td>
                                                    <td>Hồ Chí Minh, VN</td>
                                                    <td><span class="status-badge approved">Thành công</span></td>
                                                </tr>
                                                <tr>
                                                    <td>16/06/2024 09:15</td>
                                                    <td>192.168.1.102</td>
                                                    <td>Firefox 115 / Windows 10</td>
                                                    <td>Hồ Chí Minh, VN</td>
                                                    <td><span class="status-badge approved">Thành công</span></td>
                                                </tr>
                                                <tr>
                                                    <td>15/06/2024 22:45</td>
                                                    <td>203.162.4.191</td>
                                                    <td>Safari 17 / iPhone iOS 17</td>
                                                    <td>Hà Nội, VN</td>
                                                    <td><span class="status-badge rejected">Thất bại</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- User Actions History -->
                                <div class="activity-section">
                                    <h4>
                                        <i class="fas fa-list-ul"></i>
                                        Lịch sử hành động
                                    </h4>
                                    <div class="actions-filter">
                                        <select id="actionTypeFilter">
                                            <option value="all">Tất cả hành động</option>
                                            <option value="upload">Tải lên tài liệu</option>
                                            <option value="download">Tải xuống</option>
                                            <option value="share">Chia sẻ</option>
                                            <option value="comment">Bình luận</option>
                                            <option value="rating">Đánh giá</option>
                                        </select>
                                        <input type="date" id="actionDateFrom" class="filter-input">
                                        <input type="date" id="actionDateTo" class="filter-input">
                                        <button type="button" class="filter-btn" id="filterActionsBtn">
                                            <i class="fas fa-filter"></i>
                                            Lọc
                                        </button>
                                    </div>
                                    <div class="actions-timeline" id="userActionsTimeline">
                                        <div class="timeline-item">
                                            <div class="timeline-icon upload">
                                                <i class="fas fa-upload"></i>
                                            </div>
                                            <div class="timeline-content">
                                                <div class="timeline-title">Tải lên tài liệu "Giáo trình JavaScript"
                                                </div>
                                                <div class="timeline-meta">
                                                    <span class="timeline-time">2 giờ trước</span>
                                                    <span class="timeline-ip">IP: 192.168.1.105</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="timeline-item">
                                            <div class="timeline-icon download">
                                                <i class="fas fa-download"></i>
                                            </div>
                                            <div class="timeline-content">
                                                <div class="timeline-title">Tải xuống "ReactJS Advanced Guide"</div>
                                                <div class="timeline-meta">
                                                    <span class="timeline-time">1 ngày trước</span>
                                                    <span class="timeline-ip">IP: 192.168.1.102</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="timeline-item">
                                            <div class="timeline-icon comment">
                                                <i class="fas fa-comment"></i>
                                            </div>
                                            <div class="timeline-content">
                                                <div class="timeline-title">Bình luận về "Node.js Fundamentals"</div>
                                                <div class="timeline-meta">
                                                    <span class="timeline-time">2 ngày trước</span>
                                                    <span class="timeline-ip">IP: 192.168.1.105</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Trust & Reputation -->
                        <div class="tab-content" id="trust-reputation">
                            <div class="trust-reputation-container">
                                <!-- Trust Level Overview -->
                                <div class="trust-overview">
                                    <div class="trust-card">
                                        <div class="trust-level-display">
                                            <div class="trust-level-circle">
                                                <div class="trust-level-number" id="userTrustLevel">85</div>
                                                <div class="trust-level-label">Điểm tin cậy</div>
                                            </div>
                                        </div>
                                        <div class="trust-level-info">
                                            <div class="trust-level-name">Người dùng đáng tin cậy</div>
                                            <div class="trust-level-description">
                                                Người dùng có lịch sử hoạt động tích cực và ít vi phạm
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trust Components -->
                                <div class="trust-components">
                                    <div class="trust-component">
                                        <h5>
                                            <i class="fas fa-thumbs-up"></i>
                                            Điểm tích cực
                                        </h5>
                                        <div class="trust-metrics">
                                            <div class="metric-item">
                                                <label>Tài liệu chất lượng cao:</label>
                                                <span class="metric-value positive">+45</span>
                                            </div>
                                            <div class="metric-item">
                                                <label>Bình luận hữu ích:</label>
                                                <span class="metric-value positive">+25</span>
                                            </div>
                                            <div class="metric-item">
                                                <label>Đánh giá tích cực:</label>
                                                <span class="metric-value positive">+30</span>
                                            </div>
                                            <div class="metric-item">
                                                <label>Chia sẻ có giá trị:</label>
                                                <span class="metric-value positive">+15</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="trust-component">
                                        <h5>
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Điểm vi phạm
                                        </h5>
                                        <div class="trust-metrics">
                                            <div class="metric-item">
                                                <label>Spam/Nội dung không phù hợp:</label>
                                                <span class="metric-value negative">-10</span>
                                            </div>
                                            <div class="metric-item">
                                                <label>Vi phạm bản quyền:</label>
                                                <span class="metric-value negative">-15</span>
                                            </div>
                                            <div class="metric-item">
                                                <label>Báo cáo sai sự thật:</label>
                                                <span class="metric-value negative">-5</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Auto-Ban Settings: Enhanced -->
                                <div class="auto-ban-settings">
                                    <div class="section-header">
                                        <h5>
                                            <i class="fas fa-ban"></i>
                                            Cài đặt tự động khóa
                                        </h5>
                                        <div class="section-actions">
                                            <div class="auto-ban-toggle">
                                                <label class="switch-label">Kích hoạt hệ thống tự động khóa</label>
                                                <label class="switch">
                                                    <input type="checkbox" checked>
                                                    <span class="slider round"></span>
                                                </label>
                                            </div>
                                            <button type="button" class="btn-sm btn-outline">
                                                <i class="fas fa-save"></i> Lưu cài đặt
                                            </button>
                                        </div>
                                    </div>

                                    <div class="section-group">
                                        <h6 class="section-subtitle">Ngưỡng điểm danh tiếng</h6>
                                        <div class="settings-row">
                                            <div class="setting-item">
                                                <label>Tự động khóa tạm thởi khi điểm danh tiếng giảm dưới:</label>
                                                <div class="setting-value">
                                                    <input type="number" class="form-control" value="30" min="0" max="100">
                                                </div>
                                            </div>
                                            <div class="setting-item">
                                                <label>Tự động khóa vĩnh viễn khi điểm danh tiếng giảm dưới:</label>
                                                <div class="setting-value">
                                                    <input type="number" class="form-control" value="10" min="0" max="100">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="settings-row">
                                            <div class="setting-item">
                                                <label>Tự động cảnh báo khi điểm danh tiếng giảm dưới:</label>
                                                <div class="setting-value">
                                                    <input type="number" class="form-control" value="50" min="0" max="100">
                                                </div>
                                            </div>
                                            <div class="setting-item switch-item">
                                                <label>Gửi email cảnh báo khi điểm danh tiếng giảm:</label>
                                                <div class="setting-value toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" checked>
                                                        <span class="slider round"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="section-group">
                                        <h6 class="section-subtitle">Cài đặt thởi hạn</h6>
                                        <div class="settings-row">
                                            <div class="setting-item">
                                                <label>Vi phạm lần đầu:</label>
                                                <div class="setting-value">
                                                    <select class="form-control">
                                                        <option value="warning">Chỉ cảnh báo</option>
                                                        <option value="1" selected>1 ngày</option>
                                                        <option value="3">3 ngày</option>
                                                        <option value="7">7 ngày</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="setting-item">
                                                <label>Vi phạm lần 2:</label>
                                                <div class="setting-value">
                                                    <select class="form-control">
                                                        <option value="warning">Chỉ cảnh báo</option>
                                                        <option value="3">3 ngày</option>
                                                        <option value="7" selected>7 ngày</option>
                                                        <option value="15">15 ngày</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="setting-item">
                                                <label>Vi phạm lần 3:</label>
                                                <div class="setting-value">
                                                    <select class="form-control">
                                                        <option value="7">7 ngày</option>
                                                        <option value="15">15 ngày</option>
                                                        <option value="30" selected>30 ngày</option>
                                                        <option value="0">Vĩnh viễn</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="setting-item">
                                                <label>Vi phạm lần 4 trở đi:</label>
                                                <div class="setting-value">
                                                    <select class="form-control">
                                                        <option value="30">30 ngày</option>
                                                        <option value="90">90 ngày</option>
                                                        <option value="0" selected>Vĩnh viễn</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="settings-row">
                                            <div class="setting-item switch-item">
                                                <label>Đặt lại lịch sử vi phạm sau:</label>
                                                <div class="setting-value">
                                                    <select class="form-control">
                                                        <option value="never">Không bao giờ</option>
                                                        <option value="30">30 ngày không vi phạm</option>
                                                        <option value="90" selected>90 ngày không vi phạm</option>
                                                        <option value="180">180 ngày không vi phạm</option>
                                                        <option value="365">365 ngày không vi phạm</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                <input type="number" class="inline-number-input" value="3" min="1" max="10">
                                                    vi phạm liên tiếp
                                                </label>
                                                <label class="switch">
                                                    <input type="checkbox" id="tempBanRepeatedViolation">
                                                    <span class="slider"></span>
{{ ... }}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Advanced Rules -->
                                    <div class="section-group">
                                        <h6 class="section-subtitle">Quy tắc nâng cao</h6>
                                        <div class="ban-rules">
                                            <div class="ban-rule">
                                                <label>Tự động khóa nếu phát hiện hành vi đáng ngờ:</label>
                                                <label class="switch">
                                                    <input type="checkbox" id="autoBanSuspiciousActivity" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="ban-rule">
                                                <label>Khóa sau 
                                                    <input type="number" class="inline-number-input" value="5" min="1" max="20">
                                                    lần vi phạm bản quyền
                                                </label>
                                                <label class="switch">
                                                    <input type="checkbox" id="autoBanCopyrightViolation" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="ban-rule">
                                                <label>Tự động gửi cảnh báo trước khi khóa tài khoản</label>
                                                <label class="switch">
                                                    <input type="checkbox" id="autoWarnBeforeBan" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Severity Settings -->
                                    <div class="section-group">
                                        <h6 class="section-subtitle">Mức độ nghiêm trọng của vi phạm</h6>
                                        <div class="violation-severity-settings">
                                            <table class="settings-table">
                                                <thead>
                                                    <tr>
                                                        <th>Loại vi phạm</th>
                                                        <th>Mức trừ điểm</th>
                                                        <th>Cảnh báo</th>
                                                        <th>Khóa tài khoản</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Vi phạm bản quyền</td>
                                                        <td>
                                                            <input type="number" class="form-control" value="15" min="1" max="100">
                                                        </td>
                                                        <td>
                                                            <label class="switch">
                                                                <input type="checkbox" checked>
                                                                <span class="slider"></span>
                                                            </label>
                                                        </td>
                                                        <td>
                                                            <select class="form-select">
                                                                <option>Không</option>
                                                                <option>Sau 3 lần</option>
                                                                <option selected>Sau 5 lần</option>
                                                                <option>Sau 10 lần</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Nội dung không phù hợp</td>
                                                        <td>
                                                            <input type="number" class="form-control" value="10" min="1" max="100">
                                                        </td>
                                                        <td>
                                                            <label class="switch">
                                                                <input type="checkbox" checked>
                                                                <span class="slider"></span>
                                                            </label>
                                                        </td>
                                                        <td>
                                                            <select class="form-select">
                                                                <option>Không</option>
                                                                <option selected>Sau 3 lần</option>
                                                                <option>Sau 5 lần</option>
                                                                <option>Sau 10 lần</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Spam</td>
                                                        <td>
                                                            <input type="number" class="form-control" value="5" min="1" max="100">
                                                        </td>
                                                        <td>
                                                            <label class="switch">
                                                                <input type="checkbox" checked>
                                                                <span class="slider"></span>
                                                            </label>
                                                        </td>
                                                        <td>
                                                            <select class="form-select">
                                                                <option>Không</option>
                                                                <option>Sau 3 lần</option>
                                                                <option selected>Sau 5 lần</option>
                                                                <option>Sau 10 lần</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <button type="button" class="btn-sm btn-outline mt-2" id="addNewViolationType">
                                                <i class="fas fa-plus"></i> Thêm loại vi phạm mới
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Violation Charts -->
                                <div class="violation-charts">
                                    <h5>
                                        <i class="fas fa-chart-line"></i>
                                        Biểu đồ vi phạm theo thời gian
                                    </h5>
                                    
                                    <div class="chart-filters">
                                        <div class="filter-group">
                                            <label>Thời gian:</label>
                                            <select id="violationTimeRange" class="form-select">
                                                <option value="7">7 ngày qua</option>
                                                <option value="30" selected>30 ngày qua</option>
                                                <option value="90">3 tháng qua</option>
                                                <option value="180">6 tháng qua</option>
                                                <option value="365">1 năm qua</option>
                                            </select>
                                        </div>
                                        <div class="filter-group">
                                            <label>Loại vi phạm:</label>
                                            <div class="chart-legend">
                                                <label class="legend-item">
                                                    <input type="checkbox" checked class="legend-checkbox" data-type="copyright">
                                                    <span class="legend-color" style="background-color: #ef4444"></span>
                                                    <span class="legend-label">Vi phạm bản quyền</span>
                                                </label>
                                                <label class="legend-item">
                                                    <input type="checkbox" checked class="legend-checkbox" data-type="inappropriate">
                                                    <span class="legend-color" style="background-color: #f59e0b"></span>
                                                    <span class="legend-label">Nội dung không phù hợp</span>
                                                </label>
                                                <label class="legend-item">
                                                    <input type="checkbox" checked class="legend-checkbox" data-type="spam">
                                                    <span class="legend-color" style="background-color: #3b82f6"></span>
                                                    <span class="legend-label">Spam</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="violation-chart-container">
                                        <div id="violationChart" style="width: 100%; height: 300px; position: relative;" class="chart-canvas-container">
                                            <canvas id="violationChartCanvas"></canvas>
                                        </div>
                                        <div class="chart-no-data" style="display: none;">
                                            <i class="fas fa-chart-bar"></i>
                                            <p>Không có dữ liệu vi phạm trong khoảng thời gian đã chọn</p>
                                        </div>
                                    </div>
                                    
                                    <div class="chart-summary">
                                        <div class="summary-item">
                                            <div class="summary-label">Tổng số vi phạm</div>
                                            <div class="summary-value">24</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-label">Xu hướng</div>
                                            <div class="summary-value trend-down">
                                                <i class="fas fa-arrow-down"></i> 15% so với kỳ trước
                                            </div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-label">Vi phạm phổ biến nhất</div>
                                            <div class="summary-value">Nội dung không phù hợp (42%)</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-label">Mức độ nghiêm trọng</div>
                                            <div class="summary-value">Trung bình</div>
                                        </div>
                                    </div>
                                </div>
                              
                                <!-- Violation History -->
                                <div class="violation-history">
                                    <h5>
                                        <i class="fas fa-clipboard-list"></i>
                                        Lịch sử vi phạm
                                    </h5>
                                    <!-- Search & Advanced Filters for Violations -->
                                    <div class="violation-filters">
                                        <div class="filters-basic d-flex align-items-center gap-2 flex-wrap">
                                            <div class="search-box d-flex align-items-center">
                                                <input type="text" id="violationSearchKeyword" placeholder="Tìm kiếm..." class="form-control form-control-sm">
                                                <button class="btn btn-sm btn-outline-secondary ms-1" id="violationSearchBtn"><i class="fas fa-search"></i></button>
                                            </div>
                                            <select id="violationTypeFilter" class="form-select form-select-sm">
                                                <option value="all">Tất cả loại vi phạm</option>
                                                <option value="copyright">Vi phạm bản quyền</option>
                                                <option value="inappropriate">Nội dung không phù hợp</option>
                                                <option value="spam">Spam</option>
                                            </select>
                                            <select id="violationSeverityFilter" class="form-select form-select-sm">
                                                <option value="all">Tất cả mức độ</option>
                                                <option value="high">Nghiêm trọng</option>
                                                <option value="medium">Trung bình</option>
                                                <option value="low">Nhẹ</option>
                                            </select>
                                            <button class="btn btn-sm btn-link text-decoration-none" id="toggleViolationAdvancedFilters">
                                                <i class="fas fa-sliders-h"></i> Nâng cao
                                            </button>
                                        </div>

                                        <!-- Advanced Filters (hidden by default) -->
                                        <div class="filters-advanced mt-2" style="display:none;" id="violationAdvancedFilterPanel">
                                            <div class="row g-2">
                                                <div class="col-12 col-md-3">
                                                    <label class="form-label mb-1">Khoảng thời gian:</label>
                                                    <select id="violationDatePreset" class="form-select form-select-sm">
                                                        <option value="today">Hôm nay</option>
                                                        <option value="7">7 ngày qua</option>
                                                        <option value="30" selected>30 ngày qua</option>
                                                        <option value="90">3 tháng qua</option>
                                                        <option value="180">6 tháng qua</option>
                                                        <option value="custom">Tùy chọn...</option>
                                                    </select>
                                                </div>
                                                <div class="col-12 col-md-4 d-flex align-items-end" id="violationCustomDateRange" style="display:none;">
                                                    <input type="date" id="violationDateFrom" class="form-control form-control-sm me-1">
                                                    <input type="date" id="violationDateTo" class="form-control form-control-sm">
                                                </div>
                                                <div class="col-6 col-md-2 d-flex align-items-end">
                                                    <button id="applyViolationFilters" class="btn btn-sm btn-primary w-100"><i class="fas fa-filter"></i> Lọc</button>
                                                </div>
                                                <div class="col-6 col-md-2 d-flex align-items-end">
                                                    <button id="resetViolationFilters" class="btn btn-sm btn-outline-secondary w-100"><i class="fas fa-undo"></i> Đặt lại</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="violation-list">
                                        <div class="violation-item">
                                            <div class="violation-icon warning">
                                                <i class="fas fa-exclamation"></i>
                                            </div>
                                            <div class="violation-content">
                                                <div class="violation-title">Tải lên nội dung không phù hợp</div>
                                                <div class="violation-meta">
                                                    <span>12/06/2025</span>
                                                    <span class="violation-severity">Mức độ: Trung bình</span>
                                                    <span class="violation-penalty">-15 điểm</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="violation-item">
                                            <div class="violation-icon minor">
                                                <i class="fas fa-info"></i>
                                            </div>
                                            <div class="violation-content">
                                                <div class="violation-title">Spam bình luận</div>
                                                <div class="violation-meta">
                                                    <span>08/06/2024</span>
                                                    <span class="violation-severity">Mức độ: Nhẹ</span>
                                                    <span class="violation-penalty">-5 điểm</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Groups & Organization -->
                        <div class="tab-content" id="groups-organization">
                            <div class="groups-organization-container">
                                <!-- Organization List & Bulk Tools -->
                                <div class="groups-section">
                                    <div class="section-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                        <h4 class="m-0 d-flex align-items-center gap-1">
                                            <i class="fas fa-building"></i>
                                            Danh sách tổ chức
                                        </h4>
                                        <div class="org-actions d-flex gap-2">
                                            <div class="search-box d-flex align-items-center">
                                                <input type="text" id="orgSearchInput" class="form-control form-control-sm" placeholder="Tìm kiếm tổ chức...">
                                                <button class="btn btn-sm btn-outline-secondary ms-1" id="orgSearchBtn"><i class="fas fa-search"></i></button>
                                            </div>
                                            <button class="btn btn-sm btn-primary" id="addOrgBtn"><i class="fas fa-plus"></i> Thêm tổ chức</button>
                                        </div>
                                    </div>
                                    <div class="organization-table-wrapper mt-3">
                                        <table class="table table-bordered table-hover organization-table">
                                            <thead>
                                                <tr>
                                                    <th style="width:40px"><input type="checkbox" id="orgSelectAll"></th>
                                                    <th>Tên tổ chức</th>
                                                    <th>Loại</th>
                                                    <th>Số thành viên</th>
                                                    <th>Hành động</th>
                                                </tr>
                                            </thead>
                                            <tbody id="organizationTbody">
                                                <!-- Dynamic rows added by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="bulk-org-actions mt-2 d-flex gap-2 flex-wrap">
                                        <button class="btn btn-sm btn-outline-danger" id="deleteSelectedOrgs"><i class="fas fa-trash"></i> Xóa đã chọn</button>
                                        <button class="btn btn-sm btn-outline-secondary" id="exportOrgsCsv"><i class="fas fa-file-csv"></i> Xuất CSV</button>
                                    </div>
                                </div>
                                <!-- Current Groups -->
                                <div class="groups-section">
                                    <h4>
                                        <i class="fas fa-users"></i>
                                        Nhóm hiện tại
                                    </h4>
                                    <div class="current-groups">
                                        <div class="group-item">
                                            <div class="group-info">
                                                <div class="group-name">Trường Đại học Bách Khoa TP.HCM</div>
                                                <div class="group-type">Tổ chức giáo dục</div>
                                                <div class="group-role">Sinh viên</div>
                                            </div>
                                            <div class="group-actions">
                                                <button type="button" class="action-btn" title="Chỉnh sửa vai trò">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" class="action-btn danger" title="Xóa khỏi nhóm">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="group-item">
                                            <div class="group-info">
                                                <div class="group-name">Khoa Công nghệ Thông tin</div>
                                                <div class="group-type">Khoa/Bộ môn</div>
                                                <div class="group-role">Thành viên</div>
                                            </div>
                                            <div class="group-actions">
                                                <button type="button" class="action-btn" title="Chỉnh sửa vai trò">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" class="action-btn danger" title="Xóa khỏi nhóm">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Add to Groups -->
                                <div class="groups-section">
                                    <h4>
                                        <i class="fas fa-plus-circle"></i>
                                        Thêm vào nhóm
                                    </h4>
                                    <div class="add-group-form">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Chọn tổ chức:</label>
                                                <select id="organizationSelect">
                                                    <option value="">-- Chọn tổ chức --</option>
                                                    <option value="hcmut">Trường Đại học Bách Khoa TP.HCM</option>
                                                    <option value="hcmus">Trường Đại học Khoa học Tự nhiên TP.HCM
                                                    </option>
                                                    <option value="hcmiu">Trường Đại học Quốc tế TP.HCM</option>
                                                    <option value="uit">Trường Đại học Công nghệ Thông tin</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Chọn nhóm/lớp:</label>
                                                <select id="groupSelect">
                                                    <option value="">-- Chọn nhóm --</option>
                                                    <option value="cntt-k21">CNTT K21</option>
                                                    <option value="ktmt-k21">KTMT K21</option>
                                                    <option value="khmt-k21">KHMT K21</option>
                                                    <option value="httt-k21">HTTT K21</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Vai trò trong nhóm:</label>
                                                <select id="groupRoleSelect">
                                                    <option value="member">Thành viên</option>
                                                    <option value="monitor">Lớp trưởng</option>
                                                    <option value="representative">Đại diện</option>
                                                    <option value="moderator">Người điều hành</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <button type="button" class="add-btn" id="addToGroupBtn">
                                                    <i class="fas fa-plus"></i>
                                                    Thêm vào nhóm
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Organization Management -->
                                <div class="groups-section">
                                    <div class="section-header">
                                        <h4>
                                            <i class="fas fa-building"></i>
                                            Quản lý tổ chức
                                        </h4>
                                        <button type="button" class="btn-sm btn-outline" id="bulkOrgManage">
                                            <i class="fas fa-cogs"></i> Quản lý hàng loạt
                                        </button>
                                    </div>

                                    <!-- Bulk Organization Management -->
                                    <div class="bulk-org-management" style="display:none">
                                        <div class="bulk-org-tools">
                                            <h5>
                                                <i class="fas fa-users-cog"></i> 
                                                Công cụ quản lý hàng loạt
                                            </h5>
                                            <div class="bulk-tool-actions">
                                                <div class="tool-row">
                                                    <label>Thao tác:</label>
                                                    <select id="bulkOrgAction" class="form-select">
                                                        <option value="">Chọn thao tác...</option>
                                                        <option value="create">Tạo tổ chức mới</option>
                                                        <option value="assign">Gán người dùng vào tổ chức</option>
                                                        <option value="remove">Xóa người dùng khỏi tổ chức</option>
                                                        <option value="merge">Hợp nhất tổ chức</option>
                                                        <option value="import">Nhập danh sách từ file</option>
                                                    </select>
                                                </div>

                                                <!-- Tạo tổ chức mới -->
                                                <div class="action-form" id="createOrgForm" style="display:none">
                                                    <div class="form-row">
                                                        <div class="form-group">
                                                            <label>Tên tổ chức:</label>
                                                            <input type="text" class="form-control" placeholder="Nhập tên tổ chức">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Loại tổ chức:</label>
                                                            <select class="form-select">
                                                                <option value="education">Giáo dục</option>
                                                                <option value="business">Doanh nghiệp</option>
                                                                <option value="government">Cơ quan nhà nước</option>
                                                                <option value="ngo">Tổ chức phi chính phủ</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <button type="button" class="btn-sm btn-primary">
                                                            <i class="fas fa-save"></i> Tạo tổ chức
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Gán người dùng vào tổ chức -->
                                                <div class="action-form" id="assignOrgForm" style="display:none">
                                                    <div class="form-row">
                                                        <div class="form-group">
                                                            <label>Chọn tổ chức:</label>
                                                            <select class="form-select">
                                                                <option value="">-- Chọn tổ chức --</option>
                                                                <option value="hcmut">Trường Đại học Bách Khoa TP.HCM</option>
                                                                <option value="hcmus">Trường Đại học Khoa học Tự nhiên TP.HCM</option>
                                                                <option value="hcmiu">Trường Đại học Quốc tế TP.HCM</option>
                                                                <option value="uit">Trường Đại học Công nghệ Thông tin</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Vai trò trong tổ chức:</label>
                                                            <select class="form-select">
                                                                <option value="member">Thành viên</option>
                                                                <option value="student">Học sinh/Sinh viên</option>
                                                                <option value="teacher">Giảng viên/Giáo viên</option>
                                                                <option value="staff">Nhân viên</option>
                                                                <option value="admin">Quản trị viên</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="form-group">
                                                            <label>Chọn người dùng từ:</label>
                                                            <div class="selection-type">
                                                                <label class="radio-container">
                                                                    <input type="radio" name="userSelectionType" value="filter" checked>
                                                                    <span>Bộ lọc hiện tại</span>
                                                                </label>
                                                                <label class="radio-container">
                                                                    <input type="radio" name="userSelectionType" value="csv">
                                                                    <span>File CSV</span>
                                                                </label>
                                                                <label class="radio-container">
                                                                    <input type="radio" name="userSelectionType" value="manual">
                                                                    <span>Nhập thủ công</span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row" id="manualUserInput" style="display:none">
                                                        <div class="form-group full-width">
                                                            <label>Danh sách email (mỗi email một dòng):</label>
                                                            <textarea class="form-control" rows="4" placeholder="Nhập email, mỗi email một dòng"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-row" id="csvUserUpload" style="display:none">
                                                        <div class="form-group full-width">
                                                            <label>Tải lên file CSV:</label>
                                                            <input type="file" class="form-control" accept=".csv">
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <button type="button" class="btn-sm btn-primary">
                                                            <i class="fas fa-user-plus"></i> Gán người dùng
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Organization Settings -->
                                    <div class="organization-settings">
                                        <div class="org-setting-item">
                                            <label>Tự động phê duyệt tài liệu từ cùng tổ chức:</label>
                                            <label class="switch">
                                                <input type="checkbox" id="autoApproveOrg">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="org-setting-item">
                                            <label>Chia sẻ tài liệu chỉ trong tổ chức:</label>
                                            <label class="switch">
                                                <input type="checkbox" id="orgOnlySharing">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="org-setting-item">
                                            <label>Nhận thông báo từ tổ chức:</label>
                                            <label class="switch">
                                                <input type="checkbox" id="orgNotifications" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="org-setting-item">
                                            <label>Kích hoạt chế độ phê duyệt đa cấp:</label>
                                            <label class="switch">
                                                <input type="checkbox" id="multiLevelApproval">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Group Permissions -->
                                <div class="groups-section">
                                    <div class="section-header">
                                        <h4>
                                            <i class="fas fa-shield-alt"></i>
                                            Quyền theo nhóm
                                        </h4>
                                        <div class="section-actions">
                                            <select class="form-select form-select-sm">
                                                <option value="matrix">Hiển thị ma trận</option>
                                                <option value="list" selected>Hiển thị danh sách</option>
                                            </select>
                                            <button type="button" class="btn-sm btn-outline">
                                                <i class="fas fa-save"></i> Lưu thay đổi
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Detailed Permission Matrix -->
                                    <div class="permission-matrix-view" style="display:none">
                                        <div class="matrix-controls">
                                            <div class="controls-row">
                                                <label>Lọc theo tổ chức:</label>
                                                <select class="form-select form-select-sm">
                                                    <option value="all">Tất cả tổ chức</option>
                                                    <option value="hcmut">Trường Đại học Bách Khoa TP.HCM</option>
                                                    <option value="cntt">Khoa Công nghệ Thông tin</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="permission-matrix">
                                            <table class="matrix-table">
                                                <thead>
                                                    <tr>
                                                        <th class="feature-col">Tính năng</th>
                                                        <th>Sinh viên</th>
                                                        <th>Giảng viên</th>
                                                        <th>Nhân viên</th>
                                                        <th>Quản lý</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Nhóm quyền: Tài liệu -->
                                                    <tr class="group-header">
                                                        <td colspan="5">Quản lý tài liệu</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Xem tài liệu công khai</td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Xem tài liệu nội bộ</td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Tải lên tài liệu</td>
                                                        <td>
                                                            <div class="permission-setting">
                                                                <i class="fas fa-check text-success"></i>
                                                                <span class="limit-badge">5/ngày</span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="permission-setting">
                                                                <i class="fas fa-check text-success"></i>
                                                                <span class="limit-badge">Không giới hạn</span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="permission-setting">
                                                                <i class="fas fa-check text-success"></i>
                                                                <span class="limit-badge">20/ngày</span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="permission-setting">
                                                                <i class="fas fa-check text-success"></i>
                                                                <span class="limit-badge">Không giới hạn</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Phê duyệt tài liệu</td>
                                                        <td><i class="fas fa-times text-danger"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                        <td><i class="fas fa-times text-danger"></i></td>
                                                        <td><i class="fas fa-check text-success"></i></td>
                                                    </tr>
                                                    
                                                    <!-- Nhóm quyền: Nhóm -->
                                                    <tr class="group-header">
                                                        <td colspan="5">Quản lý nhóm</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Tạo nhóm học tập</td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1">Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Mời thành viên vào nhóm</td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="permission-select">
                                                                <option value="0">Không</option>
                                                                <option value="1" selected>Có</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- List View of Permissions (Default) -->
                                    <div class="group-permissions" id="permissionListView">
                                        <div class="permission-group">
                                            <h5>Trường Đại học Bách Khoa TP.HCM</h5>
                                            <div class="permission-list">
                                                <div class="permission-item">
                                                    <span>Tải lên tài liệu không giới hạn</span>
                                                    <span class="permission-status enabled">Có</span>
                                                </div>
                                                <div class="permission-item">
                                                    <span>Truy cập tài liệu nội bộ</span>
                                                    <span class="permission-status enabled">Có</span>
                                                </div>
                                                <div class="permission-item">
                                                    <span>Tạo nhóm học tập</span>
                                                    <span class="permission-status disabled">Không</span>
                                                </div>
                                                <div class="permission-item">
                                                    <span>Phê duyệt tài liệu cho sinh viên cùng tổ chức</span>
                                                    <span class="permission-status disabled">Không</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="permission-group">
                                            <h5>Khoa Công nghệ Thông tin</h5>
                                            <div class="permission-list">
                                                <div class="permission-item">
                                                    <span>Quản lý tài liệu khoa</span>
                                                    <span class="permission-status enabled">Có</span>
                                                </div>
                                                <div class="permission-item">
                                                    <span>Phê duyệt tài liệu sinh viên</span>
                                                    <span class="permission-status disabled">Không</span>
                                                </div>
                                                <div class="permission-item add-permission-btn">
                                                    <i class="fas fa-plus-circle"></i>
                                                    <span>Thêm quyền mới</span>
                                                </div>
                                            </div>
                                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 5: Limits & Quotas -->
                        <div class="tab-content" id="limits-quotas">
                            <div class="limits-quotas-container">
                                <!-- Current Usage Overview -->
                                <div class="usage-overview">
                                    <h4>
                                        <i class="fas fa-chart-pie"></i>
                                        Tổng quan sử dụng hôm nay
                                    </h4>
                                    <div class="usage-stats">
                                        <div class="usage-card download">
                                            <div class="usage-icon">
                                                <i class="fas fa-download"></i>
                                            </div>
                                            <div class="usage-info">
                                                <div class="usage-current">12</div>
                                                <div class="usage-limit">/ 50</div>
                                                <div class="usage-label">Lượt tải xuống</div>
                                                <div class="usage-bar">
                                                    <div class="usage-progress" style="width: 24%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="usage-card upload">
                                            <div class="usage-icon">
                                                <i class="fas fa-upload"></i>
                                            </div>
                                            <div class="usage-info">
                                                <div class="usage-current">3</div>
                                                <div class="usage-limit">/ 10</div>
                                                <div class="usage-label">Lượt tải lên</div>
                                                <div class="usage-bar">
                                                    <div class="usage-progress" style="width: 30%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="usage-card storage">
                                            <div class="usage-icon">
                                                <i class="fas fa-hdd"></i>
                                            </div>
                                            <div class="usage-info">
                                                <div class="usage-current">245MB</div>
                                                <div class="usage-limit">/ 1GB</div>
                                                <div class="usage-label">Dung lượng lưu trữ</div>
                                                <div class="usage-bar">
                                                    <div class="usage-progress" style="width: 24%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Daily Limits Configuration -->
                                <div class="limits-section">
                                    <h4>
                                        <i class="fas fa-calendar-day"></i>
                                        Giới hạn hàng ngày
                                    </h4>
                                    <div class="limits-config">
                                        <div class="limit-item">
                                            <div class="limit-info">
                                                <label>Số lượt tải xuống tối đa mỗi ngày:</label>
                                                <p class="limit-description">Giới hạn số file user có thể tải về trong 1
                                                    ngày</p>
                                            </div>
                                            <div class="limit-controls">
                                                <input type="number" id="downloadLimit" value="50" min="0" max="1000">
                                                <button type="button" class="limit-btn" id="updateDownloadLimit">
                                                    <i class="fas fa-save"></i>
                                                    Cập nhật
                                                </button>
                                            </div>
                                        </div>
                                        <div class="limit-item">
                                            <div class="limit-info">
                                                <label>Số lượt tải lên tối đa mỗi ngày:</label>
                                                <p class="limit-description">Giới hạn số file user có thể tải lên trong
                                                    1 ngày</p>
                                            </div>
                                            <div class="limit-controls">
                                                <input type="number" id="uploadLimit" value="10" min="0" max="100">
                                                <button type="button" class="limit-btn" id="updateUploadLimit">
                                                    <i class="fas fa-save"></i>
                                                    Cập nhật
                                                </button>
                                            </div>
                                        </div>
                                        <div class="limit-item">
                                            <div class="limit-info">
                                                <label>Dung lượng lưu trữ tối đa:</label>
                                                <p class="limit-description">Tổng dung lượng file user có thể lưu trữ
                                                </p>
                                            </div>
                                            <div class="limit-controls">
                                                <select id="storageLimit">
                                                    <option value="500">500 MB</option>
                                                    <option value="1024" selected>1 GB</option>
                                                    <option value="2048">2 GB</option>
                                                    <option value="5120">5 GB</option>
                                                    <option value="10240">10 GB</option>
                                                </select>
                                                <button type="button" class="limit-btn" id="updateStorageLimit">
                                                    <i class="fas fa-save"></i>
                                                    Cập nhật
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- File Size Restrictions -->
                                <div class="limits-section">
                                    <h4>
                                        <i class="fas fa-file-alt"></i>
                                        Giới hạn kích thước file
                                    </h4>
                                    <div class="file-size-limits">
                                        <div class="file-type-limit">
                                            <div class="file-type-info">
                                                <i class="fas fa-file-pdf"></i>
                                                <span>PDF Documents</span>
                                            </div>
                                            <div class="file-size-control">
                                                <input type="number" value="50" min="1" max="500">
                                                <span>MB</span>
                                            </div>
                                        </div>
                                        <div class="file-type-limit">
                                            <div class="file-type-info">
                                                <i class="fas fa-file-word"></i>
                                                <span>Word Documents</span>
                                            </div>
                                            <div class="file-size-control">
                                                <input type="number" value="25" min="1" max="100">
                                                <span>MB</span>
                                            </div>
                                        </div>
                                        <div class="file-type-limit">
                                            <div class="file-type-info">
                                                <i class="fas fa-file-powerpoint"></i>
                                                <span>PowerPoint</span>
                                            </div>
                                            <div class="file-size-control">
                                                <input type="number" value="100" min="1" max="500">
                                                <span>MB</span>
                                            </div>
                                        </div>
                                        <div class="file-type-limit">
                                            <div class="file-type-info">
                                                <i class="fas fa-file-archive"></i>
                                                <span>Archive Files (ZIP, RAR)</span>
                                            </div>
                                            <div class="file-size-control">
                                                <input type="number" value="200" min="1" max="1000">
                                                <span>MB</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="save-all-btn" id="saveFileSizeLimits">
                                        <i class="fas fa-save"></i>
                                        Lưu tất cả giới hạn
                                    </button>
                                </div>

                                <!-- Weekly/Monthly Reports -->
                                <div class="limits-section">
                                    <h4>
                                        <i class="fas fa-calendar-alt"></i>
                                        Báo cáo sử dụng
                                    </h4>
                                    <div class="usage-reports">
                                        <div class="report-tabs">
                                            <button type="button" class="report-tab active" data-period="week">7 ngày qua</button>
                                            <button type="button" class="report-tab" data-period="month">30 ngày qua</button>
                                        </div>
                                        <div class="report-content">
                                            <div class="report-chart" id="usageChart">
                                                <!-- Chart would be rendered here with Chart.js or similar -->
                                                <div class="chart-placeholder">
                                                    <i class="fas fa-chart-bar"></i>
                                                    <p>Biểu đồ sử dụng sẽ được hiển thị ở đây</p>
                                                </div>
                                            </div>
                                            <div class="report-summary">
                                                <div class="summary-item">
                                                    <span class="summary-label">Tổng lượt tải xuống:</span>
                                                    <span class="summary-value">284</span>
                                                </div>
                                                <div class="summary-item">
                                                    <span class="summary-label">Tổng lượt tải lên:</span>
                                                    <span class="summary-value">15</span>
                                                </div>
                                                <div class="summary-item">
                                                    <span class="summary-label">Dung lượng đã sử dụng:</span>
                                                    <span class="summary-value">1.2 GB</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quota Reset & Override -->
                                <div class="limits-section">
                                    <h4>
                                        <i class="fas fa-redo"></i>
                                        Quản lý hạn mức
                                    </h4>
                                    <div class="quota-management">
                                        <div class="quota-actions">
                                            <button type="button" class="quota-btn reset" id="resetDailyQuota">
                                                <i class="fas fa-refresh"></i>
                                                Reset hạn mức hôm nay
                                            </button>
                                            <button type="button" class="quota-btn override" id="overrideQuota">
                                                <i class="fas fa-unlock"></i>
                                                Tạm thởi bỏ giới hạn
                                            </button>
                                            <button type="button" class="quota-btn warning" id="blockUser">
                                                <i class="fas fa-ban"></i>
                                                Chặn mọi hoạt động
                                            </button>
                                        </div>
                                        <div class="quota-settings">
                                            <div class="setting-item">
                                                <label>Thông báo khi sắp đạt giới hạn (%):</label>
                                                <input type="range" id="warningThreshold" min="50" max="95" value="80">
                                                <span id="warningValue">80%</span>
                                            </div>
                                            <div class="setting-item">
                                                <label>Tự động reset hạn mức hàng ngày:</label>
                                                <label class="switch">
                                                    <input type="checkbox" id="autoResetDaily" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 6: Permissions & Roles -->
                        <div class="tab-content" id="permissions-roles">
                            <div class="permissions-roles-container">
                                <!-- Current Role -->
                                <div class="current-role-section">
                                    <h4><i class="fas fa-user-tag"></i> Vai trò hiện tại</h4>
                                    <div class="current-role-card">
                                        <div class="role-badge admin">
                                            <i class="fas fa-crown"></i>
                                            <span>Admin</span>
                                        </div>
                                        <div class="role-details">
                                            <p><strong>Mô tả:</strong> Quản trị viên có toàn quyền quản lý hệ thống</p>
                                            <p><strong>Cấp độ:</strong> Cấp 5 - Cao nhất</p>
                                            <p><strong>Ngày gán:</strong> 15/03/2024</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Role Assignment -->
                                <div class="role-assignment-section">
                                    <h4><i class="fas fa-user-cog"></i> Gán vai trò mới</h4>
                                    <div class="available-roles">
                                        <div class="role-option active" data-role="admin">
                                            <div class="role-badge admin"><i class="fas fa-crown"></i> Admin</div>
                                            <p>Quản trị viên với quyền quản lý user và nội dung</p>
                                        </div>
                                        <div class="role-option" data-role="moderator">
                                            <div class="role-badge moderator"><i class="fas fa-shield-alt"></i>
                                                Moderator</div>
                                            <p>Kiểm duyệt nội dung và quản lý hoạt động người dùng</p>
                                        </div>
                                        <div class="role-option" data-role="user">
                                            <div class="role-badge user"><i class="fas fa-user"></i> User</div>
                                            <p>Người dùng thông thường với quyền cơ bản</p>
                                        </div>
                                    </div>
                                    <button type="button" class="assign-role-btn" id="assignRoleBtn">
                                        <i class="fas fa-check"></i> Gán vai trò
                                    </button>
                                </div>

                                <!-- Permissions -->
                                <div class="detailed-permissions-section">
                                    <h4><i class="fas fa-list-check"></i> Quyền chi tiết</h4>
                                    <div class="permission-category">
                                        <h5><i class="fas fa-users"></i> Quản lý người dùng</h5>
                                        <div class="permission-list">
                                            <label class="permission-item">
                                                <input type="checkbox" checked disabled>
                                                <span>Xem danh sách người dùng</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" checked disabled>
                                                <span>Chỉnh sửa thông tin người dùng</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox">
                                                <span>Gán vai trò cho người khác</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="permission-category">
                                        <h5><i class="fas fa-file-alt"></i> Quản lý nội dung</h5>
                                        <div class="permission-list">
                                            <label class="permission-item">
                                                <input type="checkbox" checked disabled>
                                                <span>Xem tất cả tài liệu</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" checked disabled>
                                                <span>Phê duyệt tài liệu</span>
                                            </label>
                                        </div>
                                    </div>
                                    <button type="button" class="save-permissions-btn" id="savePermissionsBtn">
                                        <i class="fas fa-save"></i> Lưu thay đổi quyền
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="modal-footer">
                        <button type="button" class="action-btn" id="editUserFromDetail">
                            <i class="fas fa-edit"></i>
                            Chỉnh sửa
                        </button>
                        <button type="button" class="action-btn danger" id="deleteUserFromDetail">
                            <i class="fas fa-trash"></i>
                            Xóa người dùng
                        </button>
                        <button type="button" class="action-btn secondary" id="sendEmailFromDetail">
                            <i class="fas fa-envelope"></i>
                            Gửi email
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/main.js"></script>
    <script src="js/admin.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Admin dropdown toggle
            const adminProfile = document.querySelector('.admin-profile');
            if (adminProfile) {
                adminProfile.addEventListener('click', function () {
                    this.classList.toggle('active');
                });
            }

            // Select all checkboxes
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.checkbox-wrapper input[type="checkbox"]:not(#selectAll)');

            if (selectAll) {
                selectAll.addEventListener('change', function () {
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });

                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function () {
                        const allChecked = [...checkboxes].every(c => c.checked);
                        const someChecked = [...checkboxes].some(c => c.checked);

                        selectAll.checked = allChecked;
                        selectAll.indeterminate = someChecked && !allChecked;
                    });
                });
            }

            // Modal functionality
            const addUserBtn = document.querySelector('.add-new-btn');
            const addUserModal = document.getElementById('addUserModal');
            const modalOverlay = document.querySelector('.modal-overlay');
            const modalCloseBtn = document.querySelector('.modal-close');
            const cancelBtn = document.querySelector('.cancel-btn');

            function openModal() {
                if (addUserModal) {
                    addUserModal.classList.add('open');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeModal() {
                if (addUserModal) {
                    addUserModal.classList.remove('open');
                    document.body.style.overflow = '';
                }
            }

            if (addUserBtn) {
                addUserBtn.addEventListener('click', openModal);
            }

            if (modalOverlay) {
                modalOverlay.addEventListener('click', closeModal);
            }

            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', closeModal);
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeModal);
            }

            // Avatar upload
            const avatarUploadBtn = document.querySelector('.avatar-upload-btn');
            const avatarInput = document.getElementById('avatarInput');
            const avatarPreview = document.querySelector('.avatar-preview');
            const avatarRemoveBtn = document.querySelector('.avatar-remove-btn');

            if (avatarUploadBtn && avatarInput) {
                avatarUploadBtn.addEventListener('click', function () {
                    avatarInput.click();
                });

                avatarInput.addEventListener('change', function () {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();

                        reader.onload = function (e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'preview-image';

                            // Clear existing preview
                            avatarPreview.innerHTML = '';
                            avatarPreview.appendChild(img);
                        }

                        reader.readAsDataURL(this.files[0]);
                    }
                });
            }

            if (avatarRemoveBtn && avatarPreview) {
                avatarRemoveBtn.addEventListener('click', function () {
                    // Reset preview to placeholder
                    avatarPreview.innerHTML = '<div class="avatar-placeholder"><i class="fas fa-user"></i></div>';

                    // Clear file input
                    if (avatarInput) {
                        avatarInput.value = '';
                    }
                });
            }

            // Pagination
            const pageButtons = document.querySelectorAll('.page-btn');
            const prevButton = document.querySelector('.prev-btn');
            const nextButton = document.querySelector('.next-btn');

            pageButtons.forEach(button => {
                button.addEventListener('click', function () {
                    pageButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // Update prev/next button states
                    if (this.textContent === '1') {
                        prevButton.disabled = true;
                    } else {
                        prevButton.disabled = false;
                    }

                    if (this.textContent === '12') {
                        nextButton.disabled = true;
                    } else {
                        nextButton.disabled = false;
                    }
                });
            });
            // === SỬA HÀM showToast (sửa cả icon và hiệu ứng) ---
            function showToast(message, type = 'info') {
                let container = document.querySelector('.toast-container');
                if (!container) {
                    container = document.createElement('div');
                    container.className = 'toast-container';
                    document.body.appendChild(container);
                }
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                if (type === 'warning') icon = 'exclamation-circle';
                if (type === 'error') icon = 'times-circle';

                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-${icon} toast-icon"></i>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button type="button" class="toast-close"><i class="fas fa-times"></i></button>
                `;
                container.appendChild(toast);
                // Đóng toast
                toast.querySelector('.toast-close').addEventListener('click', function () {
                    toast.classList.add('hide');
                    setTimeout(() => { if (toast.parentNode === container) container.removeChild(toast); }, 300);
                });
                // Tự ẩn sau 5s
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        toast.classList.add('hide');
                        setTimeout(() => { if (toast.parentNode === container) container.removeChild(toast); }, 300);
                    }
                }, 5000);
                setTimeout(() => { toast.classList.add('show'); }, 10);
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            // === BULK ACTIONS FUNCTIONALITY ===
            const bulkToolbar = document.getElementById('bulkActionsToolbar');
            const selectedCountSpan = document.querySelector('.selected-count');
            const bulkProgress = document.getElementById('bulkProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            let selectedUsers = [];

            // Get all checkboxes
            const selectAllCheckbox = document.getElementById('selectAll');
            const userCheckboxes = document.querySelectorAll('input[type="checkbox"]:not(#selectAll)');

            // Function to update bulk actions toolbar visibility
            function updateBulkActionsToolbar() {
                selectedUsers = Array.from(userCheckboxes).filter(checkbox => checkbox.checked);
                const selectedCount = selectedUsers.length;

                if (selectedCount > 0) {
                    bulkToolbar.style.display = 'block';
                    selectedCountSpan.textContent = selectedCount;
                } else {
                    bulkToolbar.style.display = 'none';
                }

                // Update select all checkbox state
                if (selectedCount === 0) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                } else if (selectedCount === userCheckboxes.length) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = true;
                } else {
                    selectAllCheckbox.indeterminate = true;
                }
            }

            // Select All functionality
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function () {
                    const isChecked = this.checked;
                    userCheckboxes.forEach(checkbox => {
                        checkbox.checked = isChecked;
                    });
                    updateBulkActionsToolbar();
                });

                userCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', updateBulkActionsToolbar);
                });
            }

            // Clear selection button
            const bulkClearBtn = document.getElementById('bulkClearBtn');
            if (bulkClearBtn) {
                bulkClearBtn.addEventListener('click', function () {
                    userCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                    updateBulkActionsToolbar();
                });
            }

            // Bulk Activate Users
            const bulkActivateBtn = document.getElementById('bulkActivateBtn');
            if (bulkActivateBtn) {
                bulkActivateBtn.addEventListener('click', function () {
                    const selectedCount = selectedUsers.length;
                    if (selectedCount === 0) return;

                    if (confirm(`Bạn có chắc chắn muốn kích hoạt ${selectedCount} tài khoản đã chọn?`)) {
                        performBulkAction('activate', selectedUsers, 'Kích hoạt tài khoản');
                    }
                });
            }

            // Bulk Deactivate Users
            const bulkDeactivateBtn = document.getElementById('bulkDeactivateBtn');
            if (bulkDeactivateBtn) {
                bulkDeactivateBtn.addEventListener('click', function () {
                    const selectedCount = selectedUsers.length;
                    if (selectedCount === 0) return;

                    if (confirm(`Bạn có chắc chắn muốn khóa ${selectedCount} tài khoản đã chọn?`)) {
                        performBulkAction('deactivate', selectedUsers, 'Khóa tài khoản');
                    }
                });
            }

            // Bulk Delete Users
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            if (bulkDeleteBtn) {
                bulkDeleteBtn.addEventListener('click', function () {
                    const selectedCount = selectedUsers.length;
                    if (selectedCount === 0) return;

                    const confirmMessage = `⚠️ CẢNH BÁO: Bạn có chắc chắn muốn XÓA VĨNH VIỄN ${selectedCount} tài khoản đã chọn?\n\nHành động này KHÔNG THỂ HOÀN TÁC!`;

                    if (confirm(confirmMessage)) {
                        performBulkAction('delete', selectedUsers, 'Xóa tài khoản');
                    }
                });
            }

            // Bulk Email Users
            const bulkEmailBtn = document.getElementById('bulkEmailBtn');
            if (bulkEmailBtn) {
                bulkEmailBtn.addEventListener('click', function () {
                    const selectedCount = selectedUsers.length;
                    if (selectedCount === 0) return;

                    const emailSubject = prompt('Nhập tiêu đề email:', 'Thông báo từ EduShare');
                    if (emailSubject === null) return;

                    const emailContent = prompt('Nhập nội dung email:', 'Xin chào,\n\nĐây là thông báo từ hệ thống EduShare.\n\nTrân trọng!');
                    if (emailContent === null) return;

                    if (confirm(`Gửi email "${emailSubject}" đến ${selectedCount} người dùng đã chọn?`)) {
                        performBulkAction('email', selectedUsers, 'Gửi email', { subject: emailSubject, content: emailContent });
                    }
                });
            }

            // Bulk Role Change
            const bulkRoleDropdown = document.getElementById('bulkRoleDropdown');
            if (bulkRoleDropdown) {
                const roleItems = bulkRoleDropdown.querySelectorAll('.dropdown-item');
                roleItems.forEach(item => {
                    item.addEventListener('click', function () {
                        const selectedCount = selectedUsers.length;
                        if (selectedCount === 0) return;

                        const newRole = this.getAttribute('data-role');
                        const roleName = this.textContent.trim();

                        if (confirm(`Thay đổi vai trò của ${selectedCount} người dùng thành "${roleName}"?`)) {
                            performBulkAction('changeRole', selectedUsers, 'Thay đổi vai trò', { newRole: newRole, roleName: roleName });
                        }
                    });
                });
            }

            // Dropdown functionality
            const dropdownToggle = document.querySelector('.bulk-action-dropdown .dropdown-toggle');
            const dropdown = document.querySelector('.bulk-action-dropdown');

            dropdownToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
            });

            document.addEventListener('click', function () {
                dropdown.classList.remove('show');
            });


            // Bulk Action Performer
            function performBulkAction(action, users, actionName, options = {}) {
                // Show progress bar
                bulkProgress.style.display = 'block';
                progressFill.style.width = '0%';
                progressText.textContent = `Đang ${actionName.toLowerCase()}...`;

                const totalUsers = users.length;
                let processedUsers = 0;

                // Simulate processing each user
                const processUsers = () => {
                    if (processedUsers >= totalUsers) {
                        // All users processed
                        setTimeout(() => {
                            bulkProgress.style.display = 'none';

                            // Apply changes to UI
                            users.forEach(checkbox => {
                                const row = checkbox.closest('tr');
                                if (!row) return;

                                switch (action) {
                                    case 'activate':
                                        const activateStatusBadge = row.querySelector('.status-badge');
                                        if (activateStatusBadge) {
                                            activateStatusBadge.className = 'status-badge approved';
                                            activateStatusBadge.textContent = 'Hoạt động';
                                        }
                                        break;

                                    case 'deactivate':
                                        const deactivateStatusBadge = row.querySelector('.status-badge');
                                        if (deactivateStatusBadge) {
                                            deactivateStatusBadge.className = 'status-badge pending';
                                            deactivateStatusBadge.textContent = 'Tạm khóa';
                                        }
                                        break;

                                    case 'delete':
                                        row.style.opacity = '0.5';
                                        row.style.textDecoration = 'line-through';
                                        setTimeout(() => {
                                            row.remove();
                                        }, 1000);
                                        break;

                                    case 'changeRole':
                                        const roleBadge = row.querySelector('.role-badge');
                                        if (roleBadge && options.newRole) {
                                            roleBadge.className = `role-badge ${options.newRole}`;
                                            roleBadge.textContent = options.roleName;
                                        }
                                        break;
                                }
                            });

                            // Clear selections
                            userCheckboxes.forEach(checkbox => {
                                if (action !== 'delete') {
                                    checkbox.checked = false;
                                }
                            });
                            selectAllCheckbox.checked = false;
                            selectAllCheckbox.indeterminate = false;
                            updateBulkActionsToolbar();

                            // Show success message
                            let successMessage = '';
                            switch (action) {
                                case 'activate':
                                    successMessage = `Đã kích hoạt ${totalUsers} tài khoản thành công!`;
                                    break;
                                case 'deactivate':
                                    successMessage = `Đã khóa ${totalUsers} tài khoản thành công!`;
                                    break;
                                case 'delete':
                                    successMessage = `Đã xóa ${totalUsers} tài khoản thành công!`;
                                    break;
                                case 'changeRole':
                                    successMessage = `Đã thay đổi vai trò của ${totalUsers} người dùng thành công!`;
                                    break;
                                case 'email':
                                    successMessage = `Đã gửi email đến ${totalUsers} người dùng thành công!`;
                                    break;
                            }
                            showToast(successMessage, 'success');

                        }, 500);
                        return;
                    }

                    // Process next user
                    setTimeout(() => {
                        processedUsers++;
                        const progress = (processedUsers / totalUsers) * 100;
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `${actionName} (${processedUsers}/${totalUsers})`;
                        processUsers();
                    }, 100); // Simulate processing time
                };

                processUsers();
            }

            // === EXISTING FUNCTIONALITY ===
            // Pagination
            const pageButtons = document.querySelectorAll('.page-btn');
            const prevButton = document.querySelector('.prev-btn');
            const nextButton = document.querySelector('.next-btn');

            pageButtons.forEach(button => {
                button.addEventListener('click', function () {
                    pageButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // Update prev/next button states
                    if (this.textContent === '1') {
                        prevButton.disabled = true;
                    } else {
                        prevButton.disabled = false;
                    }

                    if (this.textContent === '12') {
                        nextButton.disabled = true;
                    } else {
                        nextButton.disabled = false;
                    }
                });
            });

            // === SEARCH AND FILTER FUNCTIONALITY ===
            const searchInput = document.querySelector('.search-input');
            const roleFilter = document.querySelectorAll('.filter-select')[0];
            const statusFilter = document.querySelectorAll('.filter-select')[1];
            const userRows = document.querySelectorAll('.users-table tbody tr');

            function filterTable() {
                const search = searchInput.value.toLowerCase();
                const role = roleFilter.value;
                const status = statusFilter.value;
                userRows.forEach(row => {
                    const name = row.querySelector('.user-name')?.textContent.toLowerCase() || '';
                    const username = row.querySelector('.user-username')?.textContent.toLowerCase() || '';
                    const email = row.cells[2]?.textContent.toLowerCase() || '';
                    const roleBadge = row.querySelector('.role-badge')?.classList || '';
                    const statusBadge = row.querySelector('.status-badge')?.classList || '';
                    let visible = true;
                    // Search filter
                    if (search && !name.includes(search) && !username.includes(search) && !email.includes(search)) visible = false;
                    // Filter role
                    if (role !== 'all' && !roleBadge.contains(role)) visible = false;
                    // Filter status
                    if (status !== 'all') {
                        const statusMap = {
                            'active': 'approved',
                            'inactive': 'rejected',
                            'pending': 'pending'
                        };

                        if (!statusBadge.contains(statusMap[status])) visible = false;
                    }
                    row.style.display = visible ? '' : 'none';
                });
            }

            if (searchInput) searchInput.addEventListener('input', filterTable);
            if (roleFilter) roleFilter.addEventListener('change', filterTable);
            if (statusFilter) statusFilter.addEventListener('change', filterTable);

            // === TOAST FUNCTION ===
            function showToast(message, type = 'info') {
                let container = document.querySelector('.toast-container');
                if (!container) {
                    container = document.createElement('div');
                    container.className = 'toast-container';
                    document.body.appendChild(container);
                }

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                if (type === 'warning') icon = 'exclamation-circle';
                if (type === 'error') icon = 'times-circle';

                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-${icon} toast-icon"></i>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button type="button" class="toast-close"><i class="fas fa-times"></i></button>
                `;
                container.appendChild(toast);
                // Close toast
                toast.querySelector('.toast-close').addEventListener('click', function () {
                    toast.classList.add('hide');
                    setTimeout(() => { if (toast.parentNode === container) container.removeChild(toast); }, 300);
                });
                // Auto hide after 5s
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        toast.classList.add('hide');
                        setTimeout(() => { if (toast.parentNode === container) container.removeChild(toast); }, 300);
                    }
                }, 5000);
                setTimeout(() => { toast.classList.add('show'); }, 10);
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            // Chọn tất cả / bỏ chọn tất cả
            const selectAll = document.getElementById('selectAll');
            if (selectAll) {
                selectAll.addEventListener('change', function () {
                    document.querySelectorAll('.users-table tbody input[type="checkbox"]').forEach(cb => {
                        cb.checked = selectAll.checked;
                    });
                });
            }
        });
        // Lọc người dùng trên bảng
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.querySelector('.search-input');
            const roleFilter = document.querySelectorAll('.filter-select')[0];
            const statusFilter = document.querySelectorAll('.filter-select')[1];
            const userRows = document.querySelectorAll('.users-table tbody tr');

            function filterTable() {
                const search = searchInput.value.toLowerCase();
                const role = roleFilter.value;
                const status = statusFilter.value;
                userRows.forEach(row => {
                    const name = row.querySelector('.user-name')?.textContent.toLowerCase() || '';
                    const username = row.querySelector('.user-username')?.textContent.toLowerCase() || '';
                    const email = row.cells[2]?.textContent.toLowerCase() || '';
                    const roleBadge = row.querySelector('.role-badge')?.classList || '';
                    const statusBadge = row.querySelector('.status-badge')?.classList || '';
                    let visible = true;
                    // Search
                    if (search && !name.includes(search) && !username.includes(search) && !email.includes(search)) visible = false;
                    // Filter role
                    if (role !== 'all' && !roleBadge.contains(role)) visible = false;
                    // Filter status
                    if (status !== 'all' && !statusBadge.contains(status)) visible = false;
                    row.style.display = visible ? '' : 'none';
                });
            }

            if (searchInput) searchInput.addEventListener('input', filterTable);
            if (roleFilter) roleFilter.addEventListener('change', filterTable);
            if (statusFilter) statusFilter.addEventListener('change', filterTable);
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Nút Thêm
            document.querySelector('.add-new-btn')?.addEventListener('click', function () {
                showToast('Chức năng Thêm người dùng sẽ được bổ sung sau!', 'info');
            });
            // Nút Export
            document.querySelector('.export-btn')?.addEventListener('click', function () {
                showToast('Đã xuất dữ liệu người dùng!', 'success');
            });
            // Action Table
            document.querySelectorAll('.users-table .action-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const title = this.getAttribute('title') || '';
                    if (title.includes('Xem')) {
                        const row = this.closest('tr');
                        const name = row.querySelector('.user-name').textContent;
                        const username = row.querySelector('.user-username').textContent;
                        const email = row.cells[2].textContent;
                        const role = row.querySelector('.role-badge').textContent;
                        const status = row.querySelector('.status-badge').textContent;
                        const avatar = row.querySelector('.user-avatar').src;
                        const joinDate = row.cells[4].textContent;
                        const documents = row.cells[5].textContent;

                        // Đổ dữ liệu vào modal
                        document.getElementById('detailUserName').textContent = name;
                        document.getElementById('detailUserUsername').textContent = username;
                        document.getElementById('detailUserEmail').textContent = email;
                        document.getElementById('detailUserRole').textContent = role;
                        document.getElementById('detailUserStatus').textContent = status;
                        document.getElementById('detailUserAvatar').src = avatar;
                        document.getElementById('detailUserJoinDate').textContent = joinDate;
                        document.getElementById('detailUserDocuments').textContent = documents;
                        document.getElementById('detailUserDownloads').textContent = Math.floor(Math.random() * 500); // placeholder
                        document.getElementById('detailUserComments').textContent = Math.floor(Math.random() * 50); // placeholder
                        document.getElementById('detailUserRating').textContent = (Math.random() * 5).toFixed(1); // placeholder

                        // Mở modal
                        const detailModal = document.getElementById('userDetailModal');
                        // Load admin notes (localStorage for demo)
                        const notesKey = 'userNotes_' + username;
                        const notesTextarea = document.getElementById('adminNotesTextarea');
                        if (notesTextarea) {
                            notesTextarea.value = localStorage.getItem(notesKey) || '';
                        }

                        detailModal.classList.add('open');
                        document.body.style.overflow = 'hidden';
                    }
                    else if (title.includes('Chỉnh sửa')) showToast('Chỉnh sửa người dùng!', 'info');
                    else if (title.includes('Khóa')) showToast('Đã khóa tài khoản người dùng!', 'warning');
                    else if (title.includes('Xác nhận')) showToast('Tài khoản đã được xác nhận!', 'success');
                    else if (title.includes('Từ chối')) showToast('Đã từ chối tài khoản!', 'error');
                });
            });

            // Đóng modal chi tiết
            document.querySelector('#userDetailModal .close-modal')?.addEventListener('click', function () {
                // Clear textarea when closing to avoid residual data
                const textarea = document.getElementById('adminNotesTextarea');
                if (textarea) textarea.value = '';

                document.getElementById('userDetailModal').classList.remove('open');
                document.body.style.overflow = '';

                // Lưu ghi chú của Admin
                document.getElementById('saveAdminNotesBtn')?.addEventListener('click', function () {
                    const textarea = document.getElementById('adminNotesTextarea');
                    if (!textarea) return;
                    const notes = textarea.value.trim();
                    const username = document.getElementById('detailUserUsername')?.textContent || '';
                    if (username) {
                        localStorage.setItem('userNotes_' + username, notes);
                        showToast('Đã lưu ghi chú của Admin!', 'success');
                    } else {
                        showToast('Không thể xác định người dùng để lưu ghi chú.', 'error');
                    }
                });
            });

        });
    </script>

    <!-- Advanced Filters JavaScript -->
    <script>
        // Advanced Filters Logic
        document.addEventListener('DOMContentLoaded', function () {
            const advancedFilterToggle = document.getElementById('advancedFilterToggle');
            const advancedFiltersPanel = document.getElementById('advancedFiltersPanel');
            const applyFiltersBtn = document.getElementById('applyAdvancedFilters');
            const resetFiltersBtn = document.getElementById('resetAdvancedFilters');
            const clearAllFiltersBtn = document.getElementById('clearAllFilters');
            const filterResultsCount = document.getElementById('filterResultsCount');

            // Multi-select components
            const roleMultiSelect = document.getElementById('roleMultiSelect');
            const roleMultiDropdown = document.getElementById('roleMultiDropdown');
            const statusMultiSelect = document.getElementById('statusMultiSelect');
            const statusMultiDropdown = document.getElementById('statusMultiDropdown');

            // Advanced Filter Toggle
            if (advancedFilterToggle && advancedFiltersPanel) {
                advancedFilterToggle.addEventListener('click', function () {
                    const isActive = advancedFilterToggle.classList.contains('active');

                    if (isActive) {
                        // Hide panel
                        advancedFiltersPanel.classList.remove('show');
                        advancedFilterToggle.classList.remove('active');
                    } else {
                        // Show panel
                        advancedFiltersPanel.classList.add('show');
                        advancedFilterToggle.classList.add('active');
                    }
                });
            }

            // Multi-select dropdowns
            function setupMultiSelect(trigger, dropdown) {
                if (!trigger || !dropdown) return;

                trigger.addEventListener('click', function (e) {
                    e.stopPropagation();
                    // Close other dropdowns
                    document.querySelectorAll('.multi-select-dropdown.show').forEach(d => {
                        if (d !== dropdown) d.classList.remove('show');
                    });
                    dropdown.classList.toggle('show');
                });

                // Handle checkbox selection
                dropdown.addEventListener('click', function (e) {
                    e.stopPropagation();
                    if (e.target.type === 'checkbox') {
                        updateMultiSelectDisplay(trigger, dropdown);
                    }
                });
            }

            function updateMultiSelectDisplay(trigger, dropdown) {
                const selectedOptions = dropdown.querySelectorAll('input[type="checkbox"]:checked');
                const placeholder = trigger.querySelector('.placeholder');

                if (selectedOptions.length === 0) {
                    placeholder.textContent = trigger === roleMultiSelect ? 'Chọn vai trò...' : 'Chọn trạng thái...';
                } else if (selectedOptions.length === 1) {
                    placeholder.textContent = selectedOptions[0].nextElementSibling.textContent.trim();
                } else {
                    placeholder.textContent = `${selectedOptions.length} mục đã chọn`;
                }
            }

            // Setup multi-selects
            setupMultiSelect(roleMultiSelect, roleMultiDropdown);
            setupMultiSelect(statusMultiSelect, statusMultiDropdown);

            // Close dropdowns when clicking outside
            document.addEventListener('click', function () {
                document.querySelectorAll('.multi-select-dropdown.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            });

            // Advanced Filter State
            let advancedFilters = {
                regDateFrom: '',
                regDateTo: '',
                lastLoginFrom: '',
                lastLoginTo: '',
                minDocuments: '',
                minDownloads: '',
                minRating: '',
                activityStatus: '',
                roles: [],
                statuses: [],
                emailSearch: '',
                fullNameSearch: '',
                phoneSearch: '',
                userIdSearch: ''
            };

            // Collect filter values
            function collectFilterValues() {
                // Date filters
                advancedFilters.regDateFrom = document.getElementById('regDateFrom')?.value || '';
                advancedFilters.regDateTo = document.getElementById('regDateTo')?.value || '';
                advancedFilters.lastLoginFrom = document.getElementById('lastLoginFrom')?.value || '';
                advancedFilters.lastLoginTo = document.getElementById('lastLoginTo')?.value || '';

                // Activity filters
                advancedFilters.minDocuments = document.getElementById('minDocuments')?.value || '';
                advancedFilters.minDownloads = document.getElementById('minDownloads')?.value || '';
                advancedFilters.minRating = document.getElementById('minRating')?.value || '';
                advancedFilters.activityStatus = document.getElementById('activityStatus')?.value || '';

                // Multi-select filters
                advancedFilters.roles = Array.from(roleMultiDropdown?.querySelectorAll('input[type="checkbox"]:checked') || [])
                    .map(cb => cb.value);
                advancedFilters.statuses = Array.from(statusMultiDropdown?.querySelectorAll('input[type="checkbox"]:checked') || [])
                    .map(cb => cb.value);

                // Search filters
                advancedFilters.emailSearch = document.getElementById('emailSearch')?.value || '';
                advancedFilters.fullNameSearch = document.getElementById('fullNameSearch')?.value || '';
                advancedFilters.phoneSearch = document.getElementById('phoneSearch')?.value || '';
                advancedFilters.userIdSearch = document.getElementById('userIdSearch')?.value || '';
            }

            // === Helper: parse dd/mm/yyyy to Date ===
            function parseDateVN(str) {
                if (!str) return null;
                const parts = str.split('/');
                if (parts.length !== 3) return null;
                const [day, month, year] = parts.map(p => parseInt(p, 10));
                return new Date(year, month - 1, day);
            }

            // Apply advanced filters
            function applyAdvancedFilters() {
                collectFilterValues();

                const tableRows = document.querySelectorAll('.users-table tbody tr');
                let visibleCount = 0;

                tableRows.forEach(row => {
                    let showRow = true;

                    const cells = row.querySelectorAll('td');
                    if (cells.length < 8) return;

                    const nameCell = cells[1];
                    const userName = nameCell.querySelector('.user-name')?.textContent.trim() || '';
                    const userEmail = cells[2]?.textContent.trim() || '';
                    const userRole = cells[3]?.querySelector('.role-badge')?.textContent.trim() || '';
                    const regDateStr = cells[4]?.textContent.trim();
                    const docCount = parseInt(cells[5]?.textContent.trim() || '0', 10);
                    const downloadCount = parseInt(cells[6]?.textContent.trim() || '0', 10);
                    const userStatus = cells[7]?.querySelector('.status-badge')?.textContent.trim() || '';

                    // Role filter
                    if (advancedFilters.roles.length && !advancedFilters.roles.some(r => {
                            return (r === 'admin' && userRole === 'Quản trị viên') ||
                                   (r === 'contributor' && userRole === 'Cộng tác viên') ||
                                   (r === 'user' && userRole === 'Người dùng');
                        })) {
                        showRow = false;
                    }

                    // Status filter
                    if (showRow && advancedFilters.statuses.length && !advancedFilters.statuses.some(s => {
                            return (s === 'active' && userStatus === 'Hoạt động') ||
                                   (s === 'inactive' && userStatus === 'Tạm khóa') ||
                                   (s === 'pending' && userStatus === 'Chờ xác nhận');
                        })) {
                        showRow = false;
                    }

                    // Text search filters
                    if (showRow && advancedFilters.emailSearch && !userEmail.toLowerCase().includes(advancedFilters.emailSearch.toLowerCase())) {
                        showRow = false;
                    }
                    if (showRow && advancedFilters.fullNameSearch && !userName.toLowerCase().includes(advancedFilters.fullNameSearch.toLowerCase())) {
                        showRow = false;
                    }

                    // Min documents/downloads
                    if (showRow && advancedFilters.minDocuments) {
                        if (docCount < parseInt(advancedFilters.minDocuments, 10)) showRow = false;
                    }
                    if (showRow && advancedFilters.minDownloads) {
                        if (downloadCount < parseInt(advancedFilters.minDownloads, 10)) showRow = false;
                    }

                    // Date range filters for registration
                    if (showRow && (advancedFilters.regDateFrom || advancedFilters.regDateTo)) {
                        const regDate = parseDateVN(regDateStr);
                        if (regDate) {
                            if (advancedFilters.regDateFrom) {
                                const from = new Date(advancedFilters.regDateFrom);
                                if (regDate < from) showRow = false;
                            }
                            if (showRow && advancedFilters.regDateTo) {
                                const to = new Date(advancedFilters.regDateTo);
                                if (regDate > to) showRow = false;
                            }
                        }
                    }

                    // Last login filters are skipped because not in table yet

                    // Show / hide
                    row.style.display = showRow ? '' : 'none';
                    if (showRow) visibleCount++;
                });

                updateFilterResultsCount(visibleCount);
                showToast(`Đã áp dụng bộ lọc nâng cao. Hiển thị ${visibleCount} người dùng.`, 'success');
            }

            // Reset filters
            function resetAdvancedFilters() {
                // Clear all input fields
                document.querySelectorAll('#advancedFiltersPanel input').forEach(input => {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });

                document.querySelectorAll('#advancedFiltersPanel select').forEach(select => {
                    select.selectedIndex = 0;
                });

                // Reset multi-select displays
                updateMultiSelectDisplay(roleMultiSelect, roleMultiDropdown);
                updateMultiSelectDisplay(statusMultiSelect, statusMultiDropdown);

                // Show all rows
                document.querySelectorAll('.users-table tbody tr').forEach(row => {
                    row.style.display = '';
                });

                // Update results count
                const totalRows = document.querySelectorAll('.users-table tbody tr').length;
                updateFilterResultsCount(totalRows);

                showToast('Đã đặt lại tất cả bộ lọc nâng cao.', 'info');
            }

            // Clear all filters (including basic filters)
            function clearAllFilters() {
                // Reset advanced filters
                resetAdvancedFilters();

                // Reset basic filters
                const searchInput = document.querySelector('.search-input');
                const roleSelect = document.querySelectorAll('.filter-select')[0];
                const statusSelect = document.querySelectorAll('.filter-select')[1];

                if (searchInput) searchInput.value = '';
                if (roleSelect) roleSelect.selectedIndex = 0;
                if (statusSelect) statusSelect.selectedIndex = 0;

                // Trigger basic filter update
                if (window.filterTable) {
                    window.filterTable();
                }

                showToast('Đã xóa tất cả bộ lọc.', 'info');
            }

            // Update filter results count
            function updateFilterResultsCount(count) {
                if (filterResultsCount) {
                    const total = document.querySelectorAll('.users-table tbody tr').length;
                    if (count === total) {
                        filterResultsCount.textContent = 'Hiển thị tất cả người dùng';
                    } else {
                        filterResultsCount.textContent = `Hiển thị ${count} / ${total} người dùng`;
                    }
                }
            }

            // Save filter preset (localStorage)
            function saveFilterPreset() {
                collectFilterValues();
                const presetName = prompt('Nhập tên cho bộ lọc này:');
                if (presetName && presetName.trim()) {
                    const presets = JSON.parse(localStorage.getItem('userFilterPresets') || '{}');
                    presets[presetName.trim()] = { ...advancedFilters };
                    localStorage.setItem('userFilterPresets', JSON.stringify(presets));
                    showToast(`Đã lưu bộ lọc "${presetName.trim()}".`, 'success');
                }
            }

            // Load filter preset
            function loadFilterPreset() {
                const presets = JSON.parse(localStorage.getItem('userFilterPresets') || '{}');
                const presetNames = Object.keys(presets);

                if (presetNames.length === 0) {
                    showToast('Không có bộ lọc nào được lưu.', 'warning');
                    return;
                }

                const selectedPreset = prompt(`Chọn bộ lọc để tải:\n${presetNames.map((name, i) => `${i + 1}. ${name}`).join('\n')}\n\nNhập số thứ tự:`);
                const index = parseInt(selectedPreset) - 1;

                if (index >= 0 && index < presetNames.length) {
                    const presetName = presetNames[index];
                    const preset = presets[presetName];
                    loadFilterValues(preset);
                    showToast(`Đã tải bộ lọc "${presetName}".`, 'success');
                }
            }

            // Load filter values into form
            function loadFilterValues(filters) {
                // Load date filters
                if (filters.regDateFrom) document.getElementById('regDateFrom').value = filters.regDateFrom;
                if (filters.regDateTo) document.getElementById('regDateTo').value = filters.regDateTo;
                if (filters.lastLoginFrom) document.getElementById('lastLoginFrom').value = filters.lastLoginFrom;
                if (filters.lastLoginTo) document.getElementById('lastLoginTo').value = filters.lastLoginTo;

                // Load activity filters
                if (filters.minDocuments) document.getElementById('minDocuments').value = filters.minDocuments;
                if (filters.minDownloads) document.getElementById('minDownloads').value = filters.minDownloads;
                if (filters.minRating) document.getElementById('minRating').value = filters.minRating;
                if (filters.activityStatus) document.getElementById('activityStatus').value = filters.activityStatus;

                // Load search filters
                if (filters.emailSearch) document.getElementById('emailSearch').value = filters.emailSearch;
                if (filters.fullNameSearch) document.getElementById('fullNameSearch').value = filters.fullNameSearch;
                if (filters.phoneSearch) document.getElementById('phoneSearch').value = filters.phoneSearch;
                if (filters.userIdSearch) document.getElementById('userIdSearch').value = filters.userIdSearch;

                // Load multi-select filters
                roleMultiDropdown?.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = filters.roles?.includes(cb.value) || false;
                });
                statusMultiDropdown?.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = filters.statuses?.includes(cb.value) || false;
                });

                // Update displays
                updateMultiSelectDisplay(roleMultiSelect, roleMultiDropdown);
                updateMultiSelectDisplay(statusMultiSelect, statusMultiDropdown);
            }

            // Event listeners
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', applyAdvancedFilters);
            }

            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', resetAdvancedFilters);
            }

            if (clearAllFiltersBtn) {
                clearAllFiltersBtn.addEventListener('click', clearAllFilters);
            }

            // Save and Load preset buttons
            document.getElementById('saveFilterPreset')?.addEventListener('click', saveFilterPreset);
            document.getElementById('loadFilterPreset')?.addEventListener('click', loadFilterPreset);

            // Initialize filter results count
            const totalRows = document.querySelectorAll('.users-table tbody tr').length;
            updateFilterResultsCount(totalRows);
        });
                document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.user-tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault(); // tránh submit nếu button nằm trong form

                    window.requestAnimationFrame(() => {
                        // Xóa active
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));

                        // Active mới
                        button.classList.add('active');
                        const target = document.getElementById(button.dataset.target);
                        if (target) {
                            target.classList.add('active');
                            //   target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        } else {
                            console.warn(`Không tìm thấy tab-content: ${button.dataset.target}`);
                        }
                    });
                });
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Nút Lưu ở modal thêm user
            const saveUserBtn = document.querySelector('.save-btn');
            if (saveUserBtn) {
                saveUserBtn.addEventListener('click', function () {
                    alert('Đã lưu thông tin người dùng mới');
                    document.getElementById('addUserModal').classList.remove('open');
                    document.body.style.overflow = '';
                });
            }
        
            // Nút Lưu quyền
            const savePermissionsBtn = document.getElementById('savePermissionsBtn');
            if (savePermissionsBtn) {
                savePermissionsBtn.addEventListener('click', function () {
                    alert('Đã lưu thay đổi quyền');
                });
            }
        
            // Nút Lưu giới hạn file size
            const saveFileSizeLimitsBtn = document.getElementById('saveFileSizeLimits');
            if (saveFileSizeLimitsBtn) {
                saveFileSizeLimitsBtn.addEventListener('click', function () {
                    alert('Đã lưu tất cả giới hạn kích thước file');
                });
            }
        
            // Nút Gán vai trò
            const assignRoleBtn = document.getElementById('assignRoleBtn');
            if (assignRoleBtn) {
                assignRoleBtn.addEventListener('click', function () {
                    alert('Đã gán vai trò mới');
                });
            }
        
            // Nút Cập nhật hạn mức download
            const updateDownloadLimitBtn = document.getElementById('updateDownloadLimit');
            if (updateDownloadLimitBtn) {
                updateDownloadLimitBtn.addEventListener('click', function () {
                    alert('Đã cập nhật hạn mức tải xuống');
                });
            }
        
            // Nút Cập nhật hạn mức upload
            const updateUploadLimitBtn = document.getElementById('updateUploadLimit');
            if (updateUploadLimitBtn) {
                updateUploadLimitBtn.addEventListener('click', function () {
                    alert('Đã cập nhật hạn mức tải lên');
                });
            }
        
            // Nút Cập nhật dung lượng lưu trữ
            const updateStorageLimitBtn = document.getElementById('updateStorageLimit');
            if (updateStorageLimitBtn) {
                updateStorageLimitBtn.addEventListener('click', function () {
                    alert('Đã cập nhật dung lượng lưu trữ');
                });
            }
        
            // Nút Áp dụng bộ lọc nâng cao
            const applyFiltersBtn = document.getElementById('applyAdvancedFilters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function () {
                    alert('Đã áp dụng bộ lọc nâng cao');
                });
            }
        
            // Nút Đặt lại bộ lọc nâng cao
            const resetFiltersBtn = document.getElementById('resetAdvancedFilters');
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', function () {
                    alert('Đã đặt lại bộ lọc nâng cao');
                });
            }
        
            // Nút Lưu bộ lọc preset
            const saveFilterPresetBtn = document.getElementById('saveFilterPreset');
            if (saveFilterPresetBtn) {
                saveFilterPresetBtn.addEventListener('click', function () {
                    alert('Đã lưu bộ lọc');
                });
            }
        
            // Nút Tải bộ lọc preset
            const loadFilterPresetBtn = document.getElementById('loadFilterPreset');
            if (loadFilterPresetBtn) {
                loadFilterPresetBtn.addEventListener('click', function () {
                    alert('Đã tải bộ lọc');
                });
            }
        
            // Nút Xóa tất cả bộ lọc
            const clearAllFiltersBtn = document.getElementById('clearAllFilters');
            if (clearAllFiltersBtn) {
                clearAllFiltersBtn.addEventListener('click', function () {
                    alert('Đã xóa tất cả bộ lọc');
                });
            }
        
            // Nút Thêm vào nhóm
            const addToGroupBtn = document.getElementById('addToGroupBtn');
            if (addToGroupBtn) {
                addToGroupBtn.addEventListener('click', function () {
                    alert('Đã thêm vào nhóm');
                });
            }
        
            // Nút Bulk actions
            const bulkActivateBtn = document.getElementById('bulkActivateBtn');
            if (bulkActivateBtn) {
                bulkActivateBtn.addEventListener('click', function () {
                    alert('Đã kích hoạt tài khoản');
                });
            }
        
            const bulkDeactivateBtn = document.getElementById('bulkDeactivateBtn');
            if (bulkDeactivateBtn) {
                bulkDeactivateBtn.addEventListener('click', function () {
                    alert('Đã khóa tài khoản');
                });
            }
        
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            if (bulkDeleteBtn) {
                bulkDeleteBtn.addEventListener('click', function () {
                    alert('Đã xóa người dùng');
                });
            }
        
            const bulkEmailBtn = document.getElementById('bulkEmailBtn');
            if (bulkEmailBtn) {
                bulkEmailBtn.addEventListener('click', function () {
                    alert('Đã gửi email');
                });
            }
        
            const bulkRoleBtn = document.getElementById('bulkRoleBtn');
            if (bulkRoleBtn) {
                bulkRoleBtn.addEventListener('click', function () {
                    alert('Chọn vai trò mới cho nhóm người dùng');
                });
            }
        
            const bulkClearBtn = document.getElementById('bulkClearBtn');
            if (bulkClearBtn) {
                bulkClearBtn.addEventListener('click', function () {
                    alert('Đã bỏ chọn tất cả');
                });
            }
        
            // Nút Quản lý hạn mức
            const resetDailyQuotaBtn = document.getElementById('resetDailyQuota');
            if (resetDailyQuotaBtn) {
                resetDailyQuotaBtn.addEventListener('click', function () {
                    alert('Đã reset hạn mức hôm nay');
                });
            }
        
            const overrideQuotaBtn = document.getElementById('overrideQuota');
            if (overrideQuotaBtn) {
                overrideQuotaBtn.addEventListener('click', function () {
                    alert('Đã tạm thời bỏ giới hạn');
                });
            }
        
            const blockUserBtn = document.getElementById('blockUser');
            if (blockUserBtn) {
                blockUserBtn.addEventListener('click', function () {
                    alert('Đã chặn mọi hoạt động của người dùng');
                });
            }
        });
        </script>
        <script>
            function openAdvancedFilter() {
  document.querySelector('.advanced-filters-panel').style.display = 'block';
  closeModal();
}
function openModal() {
  const modal = document.querySelector('.modal');
  if (modal) {
    modal.style.display = 'flex';  // Hoặc block tùy modal layout
    modal.classList.add('open');
  }
}

function closeModal() {
  const modal = document.querySelector('.modal');
  if (modal) {
    modal.classList.remove('open');
    modal.style.display = 'none';  // Ẩn hoàn toàn modal
  }
}


        </script>

<!-- ===== Users Table Sorting Script ===== -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const usersTable = document.querySelector('.users-table');
        if (!usersTable) return;
        const sortableHeaders = usersTable.querySelectorAll('th.sortable');
        sortableHeaders.forEach(th => {
            th.style.cursor = 'pointer';
            th.addEventListener('click', () => {
                const columnIndex = Array.from(th.parentNode.children).indexOf(th);
                const asc = th.classList.toggle('asc');
                th.classList.toggle('desc', !asc);

                // Update arrow icon on current header
                const icon = th.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-sort', 'fa-sort-up', 'fa-sort-down');
                    icon.classList.add(asc ? 'fa-sort-up' : 'fa-sort-down');
                }

                // Reset other headers state and icon
                sortableHeaders.forEach(h => {
                    if (h !== th) {
                        h.classList.remove('asc', 'desc');
                        const ic = h.querySelector('i');
                        if (ic) {
                            ic.classList.remove('fa-sort-up', 'fa-sort-down');
                            ic.classList.add('fa-sort');
                        }
                    }
                });
                const rows = Array.from(usersTable.tBodies[0].rows);
                rows.sort((a, b) => {
                    let valA = a.cells[columnIndex].textContent.trim();
                    let valB = b.cells[columnIndex].textContent.trim();
                    if (th.dataset.sort === 'joinDate') {
                        valA = new Date(valA.split('/').reverse().join('-'));
                        valB = new Date(valB.split('/').reverse().join('-'));
                    } else {
                        valA = parseInt(valA.replace(/[^0-9]/g, '')) || 0;
                        valB = parseInt(valB.replace(/[^0-9]/g, '')) || 0;
                    }
                    return asc ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
                });
                rows.forEach(r => usersTable.tBodies[0].appendChild(r));
            });
        });
    });
</script>

<!-- ===== Admin Notes Indicator Script ===== -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Show existing note indicators on page load
        document.querySelectorAll('.users-table tbody tr').forEach(row => {
            const usernameEl = row.querySelector('.user-username');
            if (!usernameEl) return;
            const username = usernameEl.textContent.trim().replace('@', '');
            const indicator = row.querySelector('.note-indicator');
            if (indicator) {
                const note = localStorage.getItem('userNotes_' + username);
                if (note && note.trim() !== '') indicator.style.display = 'inline-block';
            }
        });

        // Handle save admin note (modal)
        const saveBtn = document.getElementById('saveAdminNoteBtn');
        if (saveBtn) {
            saveBtn.addEventListener('click', function () {
                const notesTextarea = document.getElementById('adminNotesTextarea');
                const usernameField = document.querySelector('#userDetailModal .user-username');
                if (!notesTextarea || !usernameField) return;
                const username = usernameField.textContent.trim().replace('@', '');
                const note = notesTextarea.value.trim();
                localStorage.setItem('userNotes_' + username, note);

                // Update indicator in list
                document.querySelectorAll('.users-table .user-username').forEach(el => {
                    if (el.textContent.trim().replace('@', '') === username) {
                        const icon = el.querySelector('.note-indicator');
                        if (icon) icon.style.display = note ? 'inline-block' : 'none';
                    }
                });
            });
        }
    });
</script>

<!-- ===== Edit User Modal Logic ===== -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addUserModal = document.getElementById('addUserModal');
        if (!addUserModal) return;
        const modalTitle = addUserModal.querySelector('.modal-header h3');
        const saveBtn = addUserModal.querySelector('.save-btn');
        const cancelBtn = addUserModal.querySelector('.cancel-btn');
        const nameInput = document.getElementById('userName');
        const emailInput = document.getElementById('userEmail');
        const usernameInput = document.getElementById('userUsername');
        const roleSelect = document.getElementById('userRole');
        let editingRow = null;
        const addNewBtn = document.querySelector('.add-new-btn');

        // Open modal for adding new user
        if (addNewBtn) {
            addNewBtn.addEventListener('click', function () {
                editingRow = null;
                modalTitle.textContent = 'Thêm người dùng mới';
                // Clear fields
                nameInput.value = '';
                emailInput.value = '';
                usernameInput.value = '';
                roleSelect.value = 'user';
                // show password field if hidden previously
                const passwordInput = document.getElementById('userPassword');
                if (passwordInput) passwordInput.value = '';
                addUserModal.style.display = 'flex';
            });
        }

        // Open modal for edit using event delegation
        document.addEventListener('click', function(e){
            const editBtn = e.target.closest('.edit-user-btn');
            if(!editBtn) return;
            const row = editBtn.closest('tr');
                if (!row) return;
                editingRow = row;
                // Fill fields
                nameInput.value = row.querySelector('.user-name')?.textContent.trim() || '';
                emailInput.value = row.cells[2]?.textContent.trim() || '';
                usernameInput.value = row.querySelector('.user-username')?.textContent.replace('@','').trim() || '';
                const roleBadge = row.querySelector('.role-badge');
                if (roleBadge) {
                    if (roleBadge.classList.contains('admin')) roleSelect.value = 'admin';
                    else if (roleBadge.classList.contains('contributor')) roleSelect.value = 'contributor';
                    else roleSelect.value = 'user';
                }
                modalTitle.textContent = 'Chỉnh sửa người dùng';
                addUserModal.style.display = 'flex';
            });

        // Save edits
        if (saveBtn) {
            saveBtn.addEventListener('click', function () {
                if (!editingRow) return; // adding new user path not handled here
                // Simple validation
                if (!nameInput.value.trim() || !emailInput.value.trim()) {
                    alert('Vui lòng điền đầy đủ Họ tên và Email');
                    return;
                }
                // Update row
                editingRow.querySelector('.user-name').textContent = nameInput.value.trim();
                editingRow.cells[2].textContent = emailInput.value.trim();
                editingRow.querySelector('.user-username').textContent = '@' + usernameInput.value.trim();
                const badge = editingRow.querySelector('.role-badge');
                badge.textContent = roleSelect.options[roleSelect.selectedIndex].text;
                badge.className = 'role-badge ' + roleSelect.value;
                // Close modal
                editingRow = null;
                addUserModal.style.display = 'none';
            });
        }

        if (cancelBtn) {
            cancelBtn.addEventListener('click', function(){
                addUserModal.style.display = 'none';
                editingRow = null;
            });
        }
    });
</script>
        <!-- Confirm Action Modal -->
    <div class="modal" id="confirmActionModal">
        <div class="modal-overlay"></div>
        <div class="modal-container small-modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-question-circle"></i>
                    Xác nhận hành động
                </h3>
            </div>
            <div class="modal-content">
                <p id="confirmActionMessage">Bạn có chắc chắn?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="action-btn danger" id="confirmActionYes">Đồng ý</button>
                <button type="button" class="action-btn secondary" id="confirmActionNo">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal" id="editUserModal">
        <div class="modal-overlay"></div>
        <div class="modal-container medium-modal">
            <div class="modal-header">
                <h3>Chỉnh sửa người dùng</h3>
                <button type="button" class="modal-close close-edit-user"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <form id="editUserForm" class="form-grid">
                    <!-- Full Name -->
                    <div class="form-group">
                        <label for="editFullName">Họ và tên</label>
                        <input type="text" id="editFullName" required>
                    </div>
                    <!-- Username -->
                    <div class="form-group">
                        <label for="editUsername">Username</label>
                        <input type="text" id="editUsername" required>
                    </div>
                    <!-- Email -->
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <!-- Role -->
                    <div class="form-group">
                        <label for="editRole">Vai trò</label>
                        <select id="editRole">
                            <option value="admin">Quản trị viên</option>
                            <option value="contributor">Cộng tác viên</option>
                            <option value="user">Người dùng</option>
                        </select>
                    </div>
                    <!-- Status -->
                    <div class="form-group">
                        <label for="editStatus">Trạng thái</label>
                        <select id="editStatus">
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Tạm khóa</option>
                            <option value="pending">Chờ xác nhận</option>
                        </select>
                    </div>
                    <!-- Buttons -->
                    <div class="modal-footer">
                        <button type="submit" class="action-btn primary">Lưu</button>
                        <button type="button" class="action-btn secondary" id="cancelEditUser">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Edit Script -->
    <script src="js/users.js"></script>
</body>

</html>